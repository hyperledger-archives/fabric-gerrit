<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 31519<br><strong>Subject</strong>: [FAB-15450] validate historydb key if it contains nils<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 5/23/2019, 3:43:27 PM<br><strong>LastUpdated</strong>: 6/11/2019, 11:17:36 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-15450] validate historydb key if it contains nils

There was a logic to skip keys with nil bytes from the historydb results.
However, because some valid blockNumTranNumBytes may also contain
nil bytes, these history keys are filtered out.

This CR updates the logic to handle decoding error and process all keys
returned by range query no matter if blockNumTranNumBytes contains
a nil byte. If there is a decoding error, block:tran cannot be found,
or key is not present in write set, it means that the key is a false key
and will be skipped.

Change-Id: I296479af55b7c750ef8f797faa807ee0f5489b0a
Signed-off-by: Wenjian Qiao <wenjianq@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/23/2019, 3:43:27 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:48:07 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13938/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:48:29 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:55:08 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:55:49 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13938/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13938</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:57:38 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12326/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:58:04 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:58:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8915/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 3:58:51 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 4:31:53 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 4:38:07 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 4:38:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12326/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12326

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8915/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8915</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/23/2019, 11:03:55 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:04:04 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13943/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:04:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:10:29 PM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:11:11 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13943/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13943</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:12:52 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12330/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:13:15 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:13:29 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8918/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:13:55 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:42:03 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:52:22 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 11:53:10 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12330/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12330

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8918/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8918</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/24/2019, 8:51:00 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 8:54:12 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12339/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 8:54:39 AM<br><strong>Message</strong>: <pre>Patch Set 2: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 9:22:16 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 9:22:58 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12339/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12339</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 5/27/2019, 11:25:00 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)

Do we really need to pull the block/tx and check its write set?
I'm afraid this will degrade the performance a lot.

Otherwise, lGTM, thanks!</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/28/2019, 12:55:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 12:56:58 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14020/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 12:57:25 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:03:58 PM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:04:40 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14020/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14020</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:05:32 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8994/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:06:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:06:09 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12406/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:06:40 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/28/2019, 1:09:35 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)

Thank you Baohua.

Is your comment for all keys or only the keys with nil bytes? To get history, we need to look up the key in write set in order to get the value for the key.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:36:28 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:44:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 1:44:54 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12406/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12406

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8994/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8994</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 5/28/2019, 8:07:47 PM<br><strong>Message</strong>: <pre>Patch Set 3:

> (1 comment)
 > 
 > Thank you Baohua.
 > 
 > Is your comment for all keys or only the keys with nil bytes? To
 > get history, we need to look up the key in write set in order to
 > get the value for the key.

For the affected keys, curious to know if there's potential in this case to slow down the performance a lot.
Besides, UT has issue this time :)
Thanks!</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 5/28/2019, 8:15:51 PM<br><strong>Message</strong>: <pre>Patch Set 3:

rerun UnitTest</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/28/2019, 9:09:28 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 9:11:46 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12432/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 9:12:13 PM<br><strong>Message</strong>: <pre>Patch Set 3: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 9:46:41 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/28/2019, 9:47:34 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12432/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12432</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 7:58:19 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:02:04 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14049/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:02:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 8:05:18 AM<br><strong>Message</strong>: <pre>Patch Set 4:

> For the affected keys, curious to know if there's potential in this
 > case to slow down the performance a lot.
 > Besides, UT has issue this time :)
 > Thanks!

It s not common that ta false key can be decoded to valid block number and tran number. Therefore, it is uncommon to get to the point to unmarshal RW set for false keys. Meanwhile, I added a new check to skip false keys. Most of false keys (if not all) should be stopped with this new check.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:09:06 AM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:09:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14049/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14049</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:11:25 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9023/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:11:57 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:12:23 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12436/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:12:52 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:43:16 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:58:46 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/29/2019, 8:59:37 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9023/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9023

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12436/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12436</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 2:54:01 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(20 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:00:00 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Sorry Wenjian - It seems that I had started review with the previous patch and forgot about that reviewed the latest patch again. Hence, some of the comments may seem duplicate - please ignore such duplicates. Sorry for the inconvenience.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:15:05 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(3 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:18:44 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:31:12 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:39:18 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/29/2019, 3:41:49 PM<br><strong>Message</strong>: <pre>Patch Set 4:

> (1 comment)

lol :-)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 8:19:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:24:40 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14085/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:25:07 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 8:27:14 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(18 comments)

Manish and Senthil,

Thank you for your comments. I have updated the code accordingly. Please review again.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:33:00 AM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:33:10 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9059/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:33:35 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:34:03 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14085/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14085</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:37:55 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12468/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 8:38:23 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 9:08:22 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 9:16:44 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 9:17:29 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9059/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9059

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12468/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12468</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 9:19:42 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 10:02:08 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:03:50 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14093/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:04:21 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:12:20 AM<br><strong>Message</strong>: <pre>Patch Set 6: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:13:13 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14093/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14093</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:13:55 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9065/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:14:25 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12473/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:14:28 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:14:52 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:42:23 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:51:45 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/30/2019, 10:52:24 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12473/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12473

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9065/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9065</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 12:06:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(5 comments)

Thanks Wenjian LGTM. Will look at the tests now... A few minor nits and would like someone else to weight in their opinions on a couple comment about changing logs debug to info</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 12:12:03 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/30/2019, 1:32:32 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 2:41:18 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(7 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/30/2019, 2:54:58 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/2/2019, 10:40:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:45:55 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14177/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:46:22 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:53:07 PM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:53:53 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14177/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14177</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:55:46 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9143/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:56:09 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:56:42 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12548/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 10:57:05 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/2/2019, 11:01:08 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:06:56 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14178/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:07:30 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:16:21 PM<br><strong>Message</strong>: <pre>Patch Set 8: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:17:12 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9143/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9143

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12548/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12548</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:17:19 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14178/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14178</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:19:01 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9144/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:19:29 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:19:36 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12549/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:20:00 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/2/2019, 11:47:38 PM<br><strong>Message</strong>: <pre>Patch Set 8: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 12:18:55 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 12:20:15 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9144/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9144

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12549/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12549</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/3/2019, 7:28:44 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(13 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 6/3/2019, 11:55:09 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(2 comments)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/3/2019, 3:58:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 4:03:07 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14212/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 4:03:32 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 4:07:55 PM<br><strong>Message</strong>: <pre>Patch Set 9: F1-VerifyBuild-1

code checks are failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 4:08:41 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14212/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14212</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/3/2019, 4:55:33 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:00:41 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14217/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:01:13 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:09:57 PM<br><strong>Message</strong>: <pre>Patch Set 10: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:11:01 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14217/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14217</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:12:07 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9178/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:12:33 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:12:42 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12582/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:13:10 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:46:09 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:53:00 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/3/2019, 5:53:38 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12582/ : UNSTABLE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12582

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9178/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9178</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/3/2019, 5:53:50 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 6/4/2019, 4:36:45 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+1

(11 comments)

Thanks Wenjian for your patience on this. A few largely cleanup related comments</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/5/2019, 5:22:39 PM<br><strong>Message</strong>: <pre>Patch Set 11: Patch Set 10 was rebased</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/9/2019, 11:08:08 PM<br><strong>Message</strong>: <pre>Patch Set 11:

(11 comments)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/9/2019, 11:09:57 PM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:10:07 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14470/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:10:28 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:16:03 PM<br><strong>Message</strong>: <pre>Patch Set 12: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:16:12 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9385/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:16:39 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:16:39 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14470/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14470</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:21:52 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12803/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:22:20 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:52:57 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:59:01 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/9/2019, 11:59:45 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9385/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9385

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12803/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12803</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 6/10/2019, 9:23:17 AM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 6/10/2019, 9:34:54 AM<br><strong>Message</strong>: <pre>Patch Set 13: Patch Set 12 was rebased</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 6/11/2019, 2:09:25 AM<br><strong>Message</strong>: <pre>Patch Set 13: Code-Review+1</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 6/11/2019, 7:16:23 AM<br><strong>Message</strong>: <pre>Patch Set 13: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 6/11/2019, 7:16:27 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by David Enyeart</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 7:16:36 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6884/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 7:20:51 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5570/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 7:33:12 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6884/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6884

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5570/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5570</pre><strong>Reviewer</strong>: VIJAY BABU PUNUGUBATI - vijaypunugubati@gmail.com<br><strong>Reviewed</strong>: 6/11/2019, 10:33:37 AM<br><strong>Message</strong>: <pre>Patch Set 13:

remerge</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 10:36:08 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6888/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 10:37:18 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5574/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/11/2019, 11:17:36 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5574/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5574

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6888/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6888</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/23/2019, 3:43:27 PM<br><strong>UnmergedRevision</strong>: [c0993e2122bbf1571fa2316b1aa1cfe6d5cdd438](https://github.com/hyperledger-gerrit-archive/fabric/commit/c0993e2122bbf1571fa2316b1aa1cfe6d5cdd438)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 3:55:08 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 3:55:08 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 4:38:07 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 4:31:53 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/23/2019, 11:03:55 PM<br><strong>UnmergedRevision</strong>: [cea384fcf80dcb9926cb35c9623ea5a02232565f](https://github.com/hyperledger-gerrit-archive/fabric/commit/cea384fcf80dcb9926cb35c9623ea5a02232565f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 11:10:29 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 11:10:29 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 11:52:22 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/24/2019, 9:22:16 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/cea384fcf80dcb9926cb35c9623ea5a02232565f/common/ledger/util/util.go#L60)<br><strong>Comment</strong>: <pre>done</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/cea384fcf80dcb9926cb35c9623ea5a02232565f/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72)<br><strong>Comment</strong>: <pre>number</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/cea384fcf80dcb9926cb35c9623ea5a02232565f/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/28/2019, 12:55:13 PM<br><strong>UnmergedRevision</strong>: [311cea288443ae0176f9e5c3332019f3bb95d6f4](https://github.com/hyperledger-gerrit-archive/fabric/commit/311cea288443ae0176f9e5c3332019f3bb95d6f4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/28/2019, 1:03:58 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/28/2019, 1:03:58 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/28/2019, 1:44:15 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/28/2019, 9:46:41 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/311cea288443ae0176f9e5c3332019f3bb95d6f4/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72)<br><strong>Comment</strong>: <pre>The last byte being nil not necessarily indicates that the transaction number is zero</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/311cea288443ae0176f9e5c3332019f3bb95d6f4/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73)<br><strong>Comment</strong>: <pre>It need not be a multiple of 256</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/311cea288443ae0176f9e5c3332019f3bb95d6f4/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74)<br><strong>Comment</strong>: <pre>with the above comments, I would just categorize in two cases (The suffix can be decoded in a blockNum:tranNum or not. The latter case tells us guarantees that this is not the key of our interest, however, the former case need to be verified further by looking up in the block storage.

I would also add to the comment that in some scenarios, this can actually map to a block:tran in the block storage that contains this key but is out of order of iteration and hence the results are not guaranteed to be in order.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/29/2019, 7:58:19 AM<br><strong>UnmergedRevision</strong>: [b0e183071d601afa0cd040bd717f497ab3cddc2c](https://github.com/hyperledger-gerrit-archive/fabric/commit/b0e183071d601afa0cd040bd717f497ab3cddc2c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/29/2019, 8:09:06 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/29/2019, 8:09:06 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/29/2019, 8:58:46 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/29/2019, 8:43:16 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/common/ledger/util/util.go#L59)<br><strong>Comment</strong>: <pre>This is not the right place for this portion of the comment. 
If you want to retain this, can you move this to the place where history db code uses this function.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/common/ledger/util/util.go#L59)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/common/ledger/util/util.go#L81)<br><strong>Comment</strong>: <pre>can you please use "switch case" rather continues if's</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/common/ledger/util/util.go#L81)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L68)<br><strong>Comment</strong>: <pre>This comment is meaningless now.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L68)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72)<br><strong>Comment</strong>: <pre>it can be any number.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L72)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73)<br><strong>Comment</strong>: <pre>not required to be a multiple of 256</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73)<br><strong>Comment</strong>: <pre>Minor. This may not be true. Can be removed to avoid confusion. 

If we had used https://github.com/golang/protobuf/blob/master/proto/encode.go#L72, we would have avoided any nil bytes as the 8th bit of each byte is set to 1 to track the length of the encoded bytes. 

Current encoding scheme allows a 0x0 byte (https://gerrit.hyperledger.org/r/c/fabric/+/31519/4/common/ledger/util/util.go#37) in the encoded message when all bits in a byte is 0. For example, the third byte in `00000001 00000000 10000000` is all 0 which would become a nil byte. This binary is equivalent to 65664 which is not divisible by 256.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L73)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74)<br><strong>Comment</strong>: <pre>Keeping above two comments in mind, I'll simply categorize this into two cases. 1) blockNumTranNumBytes can be decoded 2) not decoded. 
Further, for case 1), you verify whether the stuff matches from what is present in the block.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L74)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L93)<br><strong>Comment</strong>: <pre>Having a nil byte is no special case now. Can we simply remove this check?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L93)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97)<br><strong>Comment</strong>: <pre>why is this needed? If the decoding returned an err, its sufficient to conclude that its some other key...no?
In other words, will the above error ever happen in other case?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97)<br><strong>Comment</strong>: <pre>Manish, I was thinking of the same. Then the following question came up -- what if the disk got corrupted and hence the decoder fails to decode the bytes.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97)<br><strong>Comment</strong>: <pre>We should not be worrying about the disk error handling at this level of code. That's the storage layer where it should cause failure in loading the relevant page (I believe that level db iterator gives error - as a "separate function Error()" which I guess we ignore currently and need a separate fix).

In a nutshell, the I/O error should fail in giving the content as opposed to giving the wrong content. This is a common practice and we can stick to this.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97)<br><strong>Comment</strong>: <pre>May be I am overthinking. Do you remember the article that you shared about pair programming between sanjay and jeff? Only one or a few bits got changed. That only made me think that the err needs to be processed here. I agree on handling such IO errors separately and correctly.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L97)<br><strong>Comment</strong>: <pre>Removed. I checked blockNumTranNumContainsNilByte just in case something went wrong. Agree I/O errors should be handled separately.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L109](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L109)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L109](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L109)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L125)<br><strong>Comment</strong>: <pre>with above changes, this should go off</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L125)<br><strong>Comment</strong>: <pre>We still need to return error in this case. Even if blockNumTranNumBytes are decoded successfully, it is not valid because decoding doesn't use all the bytes.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L126)<br><strong>Comment</strong>: <pre>This part can be moved to a separate function called `getBlockAndTransNum([]bytes) (uint64, uint64, error)` for two reasons. 

Reason 1: (personal liking and hence can be ignored) Next() function is getting bigger and certainly, this part can be moved out to reduce the size and for better readability. Further, this part of the code does not use any struct fields on which this method is implemented.
Reason 2: detailed debug message may not be needed as this part of the code is less critical. When the `getBlockAndTransNum` returns an error, we can check `blockNumTranNumContainsNilByte` to put the debug log and continue to the next entry. The number of lines in these three if blocks can be reduced.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L126)<br><strong>Comment</strong>: <pre>Good point. Done.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L130)<br><strong>Comment</strong>: <pre>This could be a general I/O error returned by block storage (in this case, you need to just return this to the caller). There is a specific error https://github.com/hyperledger/fabric/blob/a1ec9aa39e234f2f02122000bb1d4c023c8e20ce/common/ledger/blkstorage/blockstorage.go#L37 that indicates that this "blockNum:tranNum" does not exists (please double check ).</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L130)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L131](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L131)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L131](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L131)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L140](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L140)<br><strong>Comment</strong>: <pre>In a rare scenario, the decoded block:tran may actually have a key in the write-set (while this entry in the historydb was added for some other <ns, key, blk, tran>. Which would cause this iterator to return the history key out of order.

Can you add this behavior description in the function level comments. Also, its good to add comment from the Jira that the keys could have clashes and hence missing. Though, in practice, we don't expect to be common scenarios but if we hit into this, the code comments will save us from scratching the head a fresh</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L140](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L140)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L141](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L141)<br><strong>Comment</strong>: <pre>not as important as the above error handling but better to differentiate the errors returned from the function "getKeyModificationFromTran" (the last two errors are only meaningful to tap and interpret as key being missing).</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L141](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L141)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L142)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L142)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148)<br><strong>Comment</strong>: <pre>I fail to understand the need for additional error processing here. Let say that during the scan, we got a bad `historyKey` of  form `key\0x00blockNumTranNumBytes\0x00blockNumTranNumBytes`. This `historyKey` would be split and the `blockNumTranNumBytes\0x00blockNumTranNumBytes` would become the `blockNumTranNumBytes`. The decoder would be able to separate out the blockNum and tranNum but https://gerrit.hyperledger.org/r/c/fabric/+/31519/4/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#118 would find that the not all bytes are consumed and would skip the key. 

If we get a bad historyKey of form `key\0x00sometext\0x00blockNumTranNumBytes` and hence the `sometext\0x00blockNumTranNumBytes` as `blockNumTranNumBytes`, the decoder will fail such that the entry would be skipped.

In summary, only for a valid key, we would fetch the tranEnvelope.

Please correct me if I am wrong.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148)<br><strong>Comment</strong>: <pre>Suppose there is a key key\0x00blockNumTranNumBytes and a false key "key\0x00sometext\0x00\anotherBlockNumTranNumBytes".
I think it is possible that sometext\0x00\anotherBlockNumTranNumBytes happens to be decoded to a valid blockNum:tranNum, but key is not present in the write set.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148)<br><strong>Comment</strong>: <pre>Ah. Make sense. As we prepend the size with both blockNum and tranNum, there is a possibility of two decoded size values in the key itself which might make our decoder to split the bytes to blockNum and tranNum.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0e183071d601afa0cd040bd717f497ab3cddc2c/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L148)<br><strong>Comment</strong>: <pre>In simple terms, this error check takes care of the key clash scenario - https://jira.hyperledger.org/browse/FAB-15450?focusedCommentId=60012&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-60012</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/30/2019, 8:19:26 AM<br><strong>UnmergedRevision</strong>: [762f4da916b256ed01c8d5b8d2312d2b268ec533](https://github.com/hyperledger-gerrit-archive/fabric/commit/762f4da916b256ed01c8d5b8d2312d2b268ec533)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 8:33:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 8:33:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 9:16:44 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 9:08:22 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 5/30/2019, 10:02:08 AM<br><strong>UnmergedRevision</strong>: [26c954a859bf84dbccd73d4717b6c9cc31c00519](https://github.com/hyperledger-gerrit-archive/fabric/commit/26c954a859bf84dbccd73d4717b6c9cc31c00519)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 10:12:20 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 10:12:20 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 10:51:45 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/30/2019, 10:42:23 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util_test.go#L65](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/common/ledger/util/util_test.go#L65)<br><strong>Comment</strong>: <pre>This is not be the right place for historydb specific comments. The above line is enough as a comment on what is being tested here.

Same as below as well</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util_test.go#L65](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/common/ledger/util/util_test.go#L65)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104)<br><strong>Comment</strong>: <pre>shall we make this info?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104)<br><strong>Comment</strong>: <pre>clashing key.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104)<br><strong>Comment</strong>: <pre>This one should be very rare, I agree if it does occur it should be logged rather than debugged. I'd propose Warning over Info actually.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104)<br><strong>Comment</strong>: <pre>changed to warning</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L104)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L118)<br><strong>Comment</strong>: <pre>Because of a key clash</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L118)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>Just wondering shall we make it info?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>clashing key</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>This one should be very rare, I agree if it does occur it should be logged rather than debugged. I'd propose Warning over Info actually.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L119)<br><strong>Comment</strong>: <pre>changed to warning</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189)<br><strong>Comment</strong>: <pre>noop :-)</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189)<br><strong>Comment</strong>: <pre>nice catch. It was simply copied/pasted from the original code. Fixed.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296)<br><strong>Comment</strong>: <pre>See comments below. However, at a high level we need to assert two things programmatically 

1) "false" keys are indeed falling in the range
2) Following three functions are being exercised for error conditions because of the "false" keys.
getBlockNumTranNum
blockStore.RetrieveTxByBlockNumTranNum
getKeyModificationFromTran</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296)<br><strong>Comment</strong>: <pre>For verifying that the conditions are hit, one option could be to use a fake logger that you can change at beginning of the test and then reset at the end of the test. Fake logger would help verify that the appropriate Warning messages were printed as a result of hitting the above mentioned spots...

For Ref - https://github.com/hyperledger/fabric/blob/4fab33e3ae181799ce840c0587438023a17bfea6/core/operations/system_test.go</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L296)<br><strong>Comment</strong>: <pre>Added fakeLogger to verify error conditions of "false" keys in all 3 functions.
getBlockNumTranNum
blockStore.RetrieveTxByBlockNumTranNum
getKeyModificationFromTran</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299)<br><strong>Comment</strong>: <pre>This key won't hit the above mentioned condition</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299)<br><strong>Comment</strong>: <pre>The key actually hit the mentioned condition. Decoding failed because size was 12 (> 8).</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L299)<br><strong>Comment</strong>: <pre>Yes, you are right. My bad - I took the above key as final history key. Sorry for the confusion (same for the comments below)</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L304](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L304)<br><strong>Comment</strong>: <pre>This key won't hit the above mentioned condition.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L304](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L304)<br><strong>Comment</strong>: <pre>The key actually hit the mentioned condition. I added a comment to  explain it.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L308)<br><strong>Comment</strong>: <pre>This key won't hit the above mentioned condition. The key is getting in as a transaction 0 and not 1. So, this key will not clash</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L308)<br><strong>Comment</strong>: <pre>The key actually hit the mentioned condition. It gets blockNum 16777474 and tranNum 1.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L321)<br><strong>Comment</strong>: <pre>Can we add here an assertion to make sure that the "false" keys are indeed falling in the range (and hence hitting the filter code) of the range query for the given key?

One way is to use internal scanner to get access to raw keys and match with each of the https://gerrit.hyperledger.org/r/#/c/fabric/+/31519/6/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go@45</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L321)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L380](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L380)<br><strong>Comment</strong>: <pre>"numEntries == 256" (is a better and more readable check) because, the current check does not ensure that the "value256" indeed is retrieved from block 256.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L380](https://github.com/hyperledger-gerrit-archive/fabric/blob/26c954a859bf84dbccd73d4717b6c9cc31c00519/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L380)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/2/2019, 10:40:53 PM<br><strong>UnmergedRevision</strong>: [ea0b43226f841ced849713512869a11789577e99](https://github.com/hyperledger-gerrit-archive/fabric/commit/ea0b43226f841ced849713512869a11789577e99)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 10:53:07 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 10:53:07 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 11:17:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/2/2019, 11:01:08 PM<br><strong>UnmergedRevision</strong>: [a2830aa49b64f06d9b32d6e5d8ce29b95470be39](https://github.com/hyperledger-gerrit-archive/fabric/commit/a2830aa49b64f06d9b32d6e5d8ce29b95470be39)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 11:16:21 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 11:16:21 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 12:18:55 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/2/2019, 11:47:38 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/a2830aa49b64f06d9b32d6e5d8ce29b95470be39/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L95)<br><strong>Comment</strong>: <pre>Yes, this is unavoidable as goleveldb iterator tries to reuse the byte array for keys and values for the Next() call. The only option I see to avoid this code is to use a hand-written fake/mock and performing this copy in that.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/a2830aa49b64f06d9b32d6e5d8ce29b95470be39/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L95)<br><strong>Comment</strong>: <pre>Thank you Manish for the explanation. I also thought about the same to manually implement a fake logger that would make a copy inside Warnf method. Have pushed a new CR for it.</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/3/2019, 3:58:53 PM<br><strong>UnmergedRevision</strong>: [a6b9d12adcac7f3a046c4f522728305cfe4e1caf](https://github.com/hyperledger-gerrit-archive/fabric/commit/a6b9d12adcac7f3a046c4f522728305cfe4e1caf)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 4:07:55 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/3/2019, 4:55:33 PM<br><strong>UnmergedRevision</strong>: [02dfaed53d1d65c2cb6bef2b4a2002b444135001](https://github.com/hyperledger-gerrit-archive/fabric/commit/02dfaed53d1d65c2cb6bef2b4a2002b444135001)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:09:57 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:09:57 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:53:00 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:46:09 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 6/4/2019, 4:36:45 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/common/ledger/util/util_test.go#L77)<br><strong>Comment</strong>: <pre>proto.EncodeVarint(uint64(8)) and remove line 75?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [common/ledger/util/util_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/common/ledger/util/util_test.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historydb.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historydb.go#L29)<br><strong>Comment</strong>: <pre>This file/package is not the right choice for this interface. As you see that as per the current code structure, this package defines the interfaces that are to be implemented by an implementation of history db. Whereas this new interface is what you want to be a dependency for the historyleveldb implementation.

This should be moved to the package historyleveldb. The location for the fake package would also change accordingly. Also, can you make this interface unexported?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historydb.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historydb.go#L29)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L51)<br><strong>Comment</strong>: <pre>forgot to remove?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L51)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189)<br><strong>Comment</strong>: <pre>decode</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go#L189)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367)<br><strong>Comment</strong>: <pre>better to do in a defer statement in next to line 350.
Below as well...</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367)<br><strong>Comment</strong>: <pre>Do you need this casting?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L367)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L387](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L387)<br><strong>Comment</strong>: <pre>This same as is misleading here. The actual bytes for both would be different. Perhaps, you can say "would be decoded as"</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L387](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L387)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L442](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L442)<br><strong>Comment</strong>: <pre>This is a tough one... this is actually not a clashing key in the sense of over-writing the kay. Both the keys would in fact be present. In a general sense, this is many to many mapping case when we decode bytes to <ns, key, ...>. Can we change this portion of the message to reflect this. 

If you cannot find a better word, can you just define the "clashing key" a bit better in the docs.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L442](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L442)<br><strong>Comment</strong>: <pre>Done. Removed "clashing" and added comments.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L537](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L537)<br><strong>Comment</strong>: <pre>this is not correct when expectedMatchCount is zero. Can you remove this and simply have assert.Equal?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L537](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L537)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L541](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L541)<br><strong>Comment</strong>: <pre>This function name created a confusion for a while. Can you rename this to either "exhaustQueryExecutor" or do this functioning in-line.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L541](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L541)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L576](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L576)<br><strong>Comment</strong>: <pre>extra?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L576](https://github.com/hyperledger-gerrit-archive/fabric/blob/02dfaed53d1d65c2cb6bef2b4a2002b444135001/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_test.go#L576)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/5/2019, 5:22:39 PM<br><strong>UnmergedRevision</strong>: [e1edfe4a56637975536873d670dcd91d4b182eb5](https://github.com/hyperledger-gerrit-archive/fabric/commit/e1edfe4a56637975536873d670dcd91d4b182eb5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:09:57 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:09:57 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:53:00 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/3/2019, 5:46:09 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 6/4/2019, 4:36:45 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/9/2019, 11:09:57 PM<br><strong>UnmergedRevision</strong>: [024a0c52d46eecb78542ca076a03dca43ee620b2](https://github.com/hyperledger-gerrit-archive/fabric/commit/024a0c52d46eecb78542ca076a03dca43ee620b2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:16:03 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:16:03 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:59:01 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:52:57 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 6/10/2019, 9:23:17 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Uploader</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Created</strong>: 6/10/2019, 9:34:54 AM<br><strong>GitHubMergedRevision</strong>: [009e688dad636a4c4ca846c9c738880e943c8f70](https://github.com/hyperledger-gerrit-archive/fabric/commit/009e688dad636a4c4ca846c9c738880e943c8f70)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:16:03 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:16:03 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:59:01 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/9/2019, 11:52:57 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 6/10/2019, 9:23:17 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Approved</strong>: 6/11/2019, 2:09:25 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 6/11/2019, 7:16:23 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: David Enyeart<br><strong>Merged</strong>: 6/11/2019, 7:16:27 AM<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/expiry_keeper.go#L127](https://github.com/hyperledger-gerrit-archive/fabric/blob/009e688dad636a4c4ca846c9c738880e943c8f70/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/expiry_keeper.go#L127)<br><strong>Comment</strong>: <pre>While we don't expect errors here, I think as a practice we should always provide some additional context when returning an error so that we know where the error came from.</pre></blockquote>