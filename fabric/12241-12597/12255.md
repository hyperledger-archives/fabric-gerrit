<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 12255<br><strong>Subject</strong>: [FAB-5659] CouchDB bulk update config max batch size<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/8/2017, 9:38:36 AM<br><strong>LastUpdated</strong>: 9/25/2017, 5:39:54 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-5659] CouchDB bulk update config max batch size

CouchDB bulk updates should allow a configurable max batch size.
Http requests with an excessive size could cause failures.

Max batch size should be configurable in core.yaml along with other
CouchDB config settings.

Change-Id: Ifa6222dae8d2ca6a3d7dca44642091ecc4c4ab81
Signed-off-by: Chris Elder <chris.elder@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2017, 9:38:36 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 9:38:44 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10876/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 9:40:15 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6783/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 9:40:37 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9269/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 9:40:47 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15245/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 10:46:57 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/10876/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10876

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6783/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6783

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9269/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9269

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15245/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15245</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2017, 1:20:57 PM<br><strong>Message</strong>: <pre>Patch Set 1:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 1:21:05 PM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10895/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 1:22:15 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6802/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 1:22:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9288/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 1:22:51 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15264/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2017, 2:42:43 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6802/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6802

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9288/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9288

https://jenkins.hyperledger.org/job/fabric-verify-z/10895/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10895

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15264/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15264</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/20/2017, 2:55:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Rebase now that FAB-2960 is merged.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/20/2017, 2:55:40 PM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2017, 2:55:52 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11548/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2017, 2:57:37 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15923/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2017, 2:58:19 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9932/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2017, 3:01:52 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7468/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2017, 5:22:34 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7468/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7468/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7468

https://jenkins.hyperledger.org/job/fabric-verify-z/11548/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11548

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15923/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15923

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9932/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9932</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 12:37:10 AM<br><strong>Message</strong>: <pre>Patch Set 1:

rebuild-x</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 12:37:52 AM<br><strong>Message</strong>: <pre>Patch Set 1:

rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 12:39:40 AM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15945/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 12:39:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7489/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 2:27:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15945/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15945

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7489/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7489</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 5:42:17 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 5:42:25 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11573/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 5:43:29 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15947/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 5:43:57 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9955/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 5:45:24 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7491/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2017, 6:51:32 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11573/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11573

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15947/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15947

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9955/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9955

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7491/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7491</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/22/2017, 6:39:44 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Sorry...mine beat yours in... could you rebase?</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 8/22/2017, 10:14:02 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2017, 10:14:13 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11620/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2017, 10:15:23 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15991/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2017, 10:15:24 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10001/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2017, 10:16:17 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7535/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2017, 11:10:31 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11620/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11620

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15991/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15991

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10001/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10001

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7535/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7535</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/2/2017, 7:54:20 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/2/2017, 7:54:29 AM<br><strong>Message</strong>: <pre>Patch Set 4: Patch Set 3 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/2/2017, 7:54:38 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12034/ (1/4)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/2/2017, 7:54:43 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/2/2017, 7:55:58 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16391/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/2/2017, 7:56:31 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7976/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/2/2017, 7:57:01 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10403/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/2/2017, 9:32:56 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12034/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12034

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16391/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16391

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7976/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7976

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10403/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10403</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/4/2017, 8:13:01 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-2

Chris, the logic must not be correct.  I tested create two marbles in one block - marble3 and marble4. Using maxBatchUpdateSize=2.

During validation phase, bulk retrieve looks ok (although Iâ€™ll ask Senthil not to retrieve the same key multiple times, and note that maxBatchUpdateSize is not honored yet):
Entering BatchRetrieveDocumentMetadata()  keys=[lsccmarbles marblesmarble3 lsccmarbles marblesmarble4]

During commit phase, the batch updates look ok, there are two batch updates of two keys each.  But the batch retrieve logic for missing revision numbers does not - color~namebluemarble4 is retrieved three times!:
Entering BatchRetrieveDocumentMetadata()  keys=[marblescolor~namebluemarble4]
Entering BatchUpdateDocuments()  document ids=[marblescolor~namebluemarble4,marblesmarble4]
Entering BatchRetrieveDocumentMetadata()  keys=[marblescolor~namebluemarble4 marblescolor~namebluemarble3]
Entering BatchUpdateDocuments()  document ids=[marblescolor~namebluemarble3,marblesmarble3]
Entering BatchRetrieveDocumentMetadata()  keys=[marblescolor~namebluemarble4 marblescolor~namebluemarble3]</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/4/2017, 8:17:53 AM<br><strong>Message</strong>: <pre>Patch Set 4:

I've opened FAB-6023 for Senthil.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/6/2017, 10:03:03 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 10:03:12 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12143/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 10:04:37 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16486/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 10:05:04 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10493/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 10:05:41 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8068/ (4/4)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/6/2017, 10:07:28 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

Added logic to ApplyUpdates to honor the max batch size for loading committed versions.  Also added logic to LoadCommittedVersions to only load versions not found in the version cache.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:24:28 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12143/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12143

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16486/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16486

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10493/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10493

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8068/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8068</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/8/2017, 6:17:19 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(6 comments)

The function works now.  Most of the comments this time are minor (code readability, comments), but due to the complexity of the code I think the code needs to be as readable as possible.

Also, I was expecting to see some unit tests for statecouchdb where you set the batch size to a low value prior to ApplyUpdates(), to force the scenario of multiple batches. I suspect the unit tests don't currently cover the scenario where there is more than one batch full of updates.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/11/2017, 9:29:46 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:29:55 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12263/ (1/4)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/11/2017, 9:30:22 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(6 comments)

Added new unit test for small batch size.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:30:53 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16607/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:31:15 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10611/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:31:45 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8190/ (4/4)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/11/2017, 9:48:50 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:49:01 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12264/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:49:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16608/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:50:24 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/12263/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/12263/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12263

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16607/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16607/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16607

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8190/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8190/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8190

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10611/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10611</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:50:25 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10612/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 9:50:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8191/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/11/2017, 11:02:35 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12264/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12264

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16608/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16608

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10612/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10612

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8191/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8191</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/12/2017, 2:53:59 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2017, 2:54:12 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12312/ (1/4)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 9/12/2017, 2:55:32 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Dave and Manish,

I added a change to the test_util AssertEquals to allow it to support JSONs.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2017, 2:55:51 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16653/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2017, 2:56:19 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10655/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2017, 2:56:50 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8241/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2017, 4:15:41 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12312/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12312

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16653/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16653

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10655/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10655

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8241/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8241</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/23/2017, 11:41:38 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2

Sorry for the delay...looks good to me now. 

Chris, we will need some system test with many keys, large JSON, and large attachments, this will also help to determine the optimal max batch size. Please get with Nishi on system test scenarios. And please run the perf tests again so that we can see the difference between single retrieves/updates and bulk retrieves/updates (apples to apples comparison of your last ledger/couchdb perf tests).

The default in yaml is 1000, but the default in ledger_config is 500.  They should be consistent. But that is no reason to hold this up, as we will likely change the default value after getting system test findings.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 9/23/2017, 11:41:51 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Manish, can you review?</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/25/2017, 5:38:45 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(5 comments)

A few minor comments that can be taken care in separate commits.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/25/2017, 5:38:55 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/25/2017, 5:39:54 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Manish Sethi</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 8/8/2017, 9:38:36 AM<br><strong>UnmergedRevision</strong>: [f9a43a84886c41e56235b74e3c10621278165880](https://github.com/hyperledger-gerrit-archive/fabric/commit/f9a43a84886c41e56235b74e3c10621278165880)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2017, 2:27:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 8/20/2017, 2:55:40 PM<br><strong>UnmergedRevision</strong>: [fd0fc72e4337221a170314356d8ab2397c26db3e](https://github.com/hyperledger-gerrit-archive/fabric/commit/fd0fc72e4337221a170314356d8ab2397c26db3e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2017, 6:51:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 8/22/2017, 10:14:02 AM<br><strong>UnmergedRevision</strong>: [6e94ab0b8ee72745e2756cda11b0ed250f696d3b](https://github.com/hyperledger-gerrit-archive/fabric/commit/6e94ab0b8ee72745e2756cda11b0ed250f696d3b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2017, 11:10:31 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 9/2/2017, 7:54:20 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L430](https://github.com/hyperledger-gerrit-archive/fabric/blob/6e94ab0b8ee72745e2756cda11b0ed250f696d3b/sampleconfig/core.yaml#L430)<br><strong>Comment</strong>: <pre>This must be a leftover from unit testing...</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L430](https://github.com/hyperledger-gerrit-archive/fabric/blob/6e94ab0b8ee72745e2756cda11b0ed250f696d3b/sampleconfig/core.yaml#L430)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 9/2/2017, 7:54:29 AM<br><strong>UnmergedRevision</strong>: [9d29571a43bae759f5c825e51f38be5dfb777859](https://github.com/hyperledger-gerrit-archive/fabric/commit/9d29571a43bae759f5c825e51f38be5dfb777859)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/2/2017, 9:32:56 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 9/4/2017, 8:13:01 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 9/6/2017, 10:03:03 PM<br><strong>UnmergedRevision</strong>: [b0631d3dce05c0d32c67ba46f6cf7f5c5d874500](https://github.com/hyperledger-gerrit-archive/fabric/commit/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/6/2017, 11:24:28 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 9/8/2017, 6:17:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L294](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L294)<br><strong>Comment</strong>: <pre>Due to the refactoring, the step comments need to be revisisted.  For example the first step doesn't just gather revision numbers into cache now, it loops through all updates and creates batches of updates, along with corresponding batches of missing keys.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L294](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L294)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L306](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L306)<br><strong>Comment</strong>: <pre>We don't have an update yet!
I'd suggest it is more intuitive to initialize counter to 0 and then increment for each update found at the beginning of the loop.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L306](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L306)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L313](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L313)<br><strong>Comment</strong>: <pre>The for loop is no longer all about finding missing keys in the cache. This comment could be moved to the part of the loop that detects missing keys in the cache.  And have a more appropriate comment at the top of the for loop summarizing the updated loop logic.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L313](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L313)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L339](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L339)<br><strong>Comment</strong>: <pre>It is awkward to reset the counter BEFORE the processUpdateBatch(), but reset the processBatch and missingKeys AFTER the processUpdateBatch(). I'd suggest be consistent and reset them all AFTER processUpdateBatch().</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L339](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L339)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L347](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L347)<br><strong>Comment</strong>: <pre>Misplaced comment... this is not the PROCESS step but the reset.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L347](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L347)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L525](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L525)<br><strong>Comment</strong>: <pre>It's not clear to me why we need to check for versionFound and revFound here.  If the key is getting passed into LoadCommittedVersions(), doesn't that mean that the caller didn't find them in cache and wants to load them into cache.  So why check in cache for existence again here? Why was the prior logic insufficient?  I may be missing a scenario that you are trying to cover?</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L525](https://github.com/hyperledger-gerrit-archive/fabric/blob/b0631d3dce05c0d32c67ba46f6cf7f5c5d874500/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L525)<br><strong>Comment</strong>: <pre>The purpose of LoadCommittedVersions is to load version/revision info into the cache.  The calling program has no knowledge of what is in the cache, only the list of IDs of interest.   The check in this case is to see if the ID exists already,  if it doesn't, then it is initialized.   The call can be made multiple times, therefore I think the check on the cache is appropriate.</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 9/11/2017, 9:29:46 AM<br><strong>UnmergedRevision</strong>: [033189032eb25eea8ec182abd0c33194b9e9e1fb](https://github.com/hyperledger-gerrit-archive/fabric/commit/033189032eb25eea8ec182abd0c33194b9e9e1fb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/11/2017, 9:50:24 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 9/11/2017, 9:48:50 AM<br><strong>UnmergedRevision</strong>: [87861a8481438153304605fc126be14f6cad8932](https://github.com/hyperledger-gerrit-archive/fabric/commit/87861a8481438153304605fc126be14f6cad8932)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/11/2017, 11:02:35 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 9/12/2017, 2:53:59 PM<br><strong>GitHubMergedRevision</strong>: [9ffeab90d4d03ec24bee4a281f505c89f73ad4cd](https://github.com/hyperledger-gerrit-archive/fabric/commit/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2017, 4:15:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 9/25/2017, 5:38:55 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Manish Sethi<br><strong>Merged</strong>: 9/25/2017, 5:39:54 PM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 9/23/2017, 11:41:38 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L165)<br><strong>Comment</strong>: <pre>'== true' can be removed</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L166](https://github.com/hyperledger-gerrit-archive/fabric/blob/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L166)<br><strong>Comment</strong>: <pre>I guess better to test explicitly for batch size 2, 10, 12 - assuming the input batch to the test is of size 10.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L170](https://github.com/hyperledger-gerrit-archive/fabric/blob/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go#L170)<br><strong>Comment</strong>: <pre>better to reset to previous original value.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledgerconfig/ledger_config.go#L89](https://github.com/hyperledger-gerrit-archive/fabric/blob/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd/core/ledger/ledgerconfig/ledger_config.go#L89)<br><strong>Comment</strong>: <pre>better to define a constant for this string?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledgerconfig/ledger_config.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/9ffeab90d4d03ec24bee4a281f505c89f73ad4cd/core/ledger/ledgerconfig/ledger_config.go#L92)<br><strong>Comment</strong>: <pre>in yaml and in one of the tests, it is assumed to be 1000</pre></blockquote>