<strong>Project</strong>: fabric</br><strong>Branch</strong>: master<br><strong>ID</strong>: 31374<br><strong>Subject</strong>: FAB-13377 make demux more difficult to misuse<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Assignee</strong>:<strong>Created</strong>: 5/15/2019, 1:52:46 AM<br><strong>LastUpdated</strong>: 5/24/2019, 8:35:54 AM<br><strong>CommitMessage</strong>:<br><pre>FAB-13377 make demux more difficult to misuse

 - Test cases which demonstrate usage and behavior.
   - buffering of messages
   - AddChannel & DeMultiplex work after closing
   - non-blocking and idempotent Close() calls
   - previously returned channels continue to work after close.
   - interleaving the operations to make sure they don't block each other.
 - Prevent adding channels after close and pass back a closed receive-only
   channel.
 - default values of struct are usable
 - Stricter types to return and store internally.
   - Return receive-only channel.
   - Store send-only channel internally.

 - nil-check to avoid panic when TestBasic fails.

 - Idiomatic go closeChannel during inspection of DeMuxer usage.

 - Check for closed channel for usages of channel returned from AddChannel.

Change-Id: Ie7d769d7936ef99fa7ad2bf15b8b938347e95abc
Signed-off-by: Morgan Bauer <mbauer@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 1:52:46 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 1:56:31 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13739/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 1:56:53 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:02:37 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:03:27 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13739/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13739</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 2:03:34 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)

Went down this rathole while triaging the issue. I think the tests at least are reasonable to add or at the very least drive us to discuss the meaning of the code to establish the original intention.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:05:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12132/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:05:30 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:07:41 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8764/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:08:10 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:32:29 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:45:15 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 2:46:00 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12132/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12132

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8764/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8764</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 8:20:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest

The flake is FAB-15396.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 8:23:37 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12136/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 8:24:07 AM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 8:50:12 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 8:50:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12136/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12136</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 9:40:25 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest

Flake FAB-15396 again.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 9:42:43 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12139/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 9:43:06 AM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 10:08:05 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 10:08:49 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12139/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12139</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 4:26:39 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 5:16:18 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 5:17:47 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3: Patch Set 2 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:18:00 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13750/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:18:31 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 5:19:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(6 comments)

This does not solve any underlying issues, only exposes it.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:23:36 PM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:24:17 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13750/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13750</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:25:15 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12153/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:25:38 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:26:07 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8774/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:26:31 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 5:36:12 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 5:52:49 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 6:02:39 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/15/2019, 6:03:25 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12153/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12153

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8774/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8774</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 5/17/2019, 9:11:15 AM<br><strong>Message</strong>: <pre>Patch Set 3:

VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:15:26 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13777/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:15:57 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:21:26 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:23:46 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12170/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:24:12 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:24:26 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8787/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:24:55 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:50:33 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 10:00:24 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 10:01:11 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13777/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13777

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12170/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12170

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8787/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8787</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 10:41:48 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(4 comments)

I think we need to return a receive only channel and change the logic in close.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 3:08:09 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 4:11:11 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)

I'll tighten up the types and try a status chan.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 5:58:33 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 7:22:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:23:04 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13851/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:23:25 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:28:09 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:28:51 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13851/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13851</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:30:39 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12252/ (1/2)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 7:30:41 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Should Close() be forceful, and drop existing messages that are queued?
Should Close() be safe to call multiple times?


It seems like this should have an function to unsubscribe as well.
Do we always guarantee that readers continue to care about the channel they've created and registered forever until shutdown? If **any** existing channel ever stops handling messages, **all** channels hang.

It's possible that we need to look through the uses of this and check that the stop is called in the correct order.
If we are stopping readers before stopping the writers, then the writers will block and this will hang.


Updated with the stricter types, but I can't reason my way into a way to do this safely.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:31:02 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:31:19 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8848/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:31:42 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:56:15 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:08:51 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:09:35 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12252/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12252

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8848/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8848</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 9:39:57 AM<br><strong>Message</strong>: <pre>Patch Set 4:

> Patch Set 4:
> 
> Should Close() be forceful, and drop existing messages that are queued?
> Should Close() be safe to call multiple times?
> 
> 
> It seems like this should have an function to unsubscribe as well.
> Do we always guarantee that readers continue to care about the channel they've created and registered forever until shutdown? If **any** existing channel ever stops handling messages, **all** channels hang.
> 
> It's possible that we need to look through the uses of this and check that the stop is called in the correct order.
> If we are stopping readers before stopping the writers, then the writers will block and this will hang.
> 
> 
> Updated with the stricter types, but I can't reason my way into a way to do this safely.

Spent a couple of minutes looking through this this morning and it's a mess. From what I can tell, Close should drop the queued messages. It is called two places in production code:
  commImpl.Stop
  gossipServiceImpl.Stop
In both cases, a go routine was created to select on the chan returned by AddChannel and on a "die" or "stop" channel that is also closed around the same time. That implies there can already be dropped messages and that things are getting torn down anyway. (Side note: the receive that's done treats a nil receive the same as a closed channel and, imo, this could be a problem if a nil sneaks through the filter.)

It also looks like gossipImpl.Accept can hang during close. Unlike commImpl.Accept, this code does a blocking write to the "outCh" without a select on "toDieChan".

Again, this is a mess.

> Should Close() be forceful, and drop existing messages that are queued?
I'd assert yes. Current callers call this during shutdown. Specify the behavior and move on.

> Should Close() be safe to call multiple times?
It's not hard to make Close idempotent so please do so.

> Do we always guarantee that readers continue to care about the channel they've created and registered forever until shutdown?
Look at the two callers of AddChannel. They both spawn go routines that run until some event initiates shutdown.

And again, this is a mess.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 4:44:16 PM<br><strong>Message</strong>: <pre>Patch Set 4:

If you want to merge this now, I'm fine with it to have as a base.

I will examine the uses of this code in context and attempt to adjust from there.

I think the change as it exists now is better than before the change. Even without an fix for the root underlying issue, it is now documented behavior.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 6:31:47 PM<br><strong>Message</strong>: <pre>Patch Set 4:

I think I may have cracked it. There's no particular reason from the usages displayed, that we must close the channels.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 6:58:52 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 6:59:17 PM<br><strong>Message</strong>: <pre>Patch Set 5:

figured out a way to close the channels as well.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:03:35 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13874/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:04:02 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 7:04:40 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:06:10 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13874/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13874</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:08:00 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13875/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:08:31 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:14:47 PM<br><strong>Message</strong>: <pre>Patch Set 6: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:15:43 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13875/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13875</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:16:40 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12268/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:17:06 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:17:29 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8863/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:17:52 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting Integration tests</pre><strong>Reviewer</strong>: Swetha Repakula - srepaku@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 7:23:22 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 7:42:48 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:05:10 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:06:00 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12268/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12268

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8863/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8863</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 8:21:47 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:26:25 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13877/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:26:48 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:32:22 PM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:33:04 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13877/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13877</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:34:31 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12271/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:34:41 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8866/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:34:53 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 8:35:07 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:03:31 PM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:14:47 PM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:15:33 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12271/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12271

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8866/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8866</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 2:36:13 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 3:37:17 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Ronen Schaffer - ronen.schaffer@ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 9:17:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 10:48:34 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:51:13 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13887/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:51:38 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:56:48 AM<br><strong>Message</strong>: <pre>Patch Set 8: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 10:57:19 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(3 comments)

For locks and such, I prefer to know and be explicit about exactly where they act. I think we need to see it and think about it.

I didn't start out with the goal of rewriting this, but that's what ended up happening. At least we kept the interface the same!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:57:27 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13887/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13887</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:58:24 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12280/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:58:55 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:59:14 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8873/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 10:59:41 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 11:30:01 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 11:36:53 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 11:37:28 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8873/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8873

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12280/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12280</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 11:41:28 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)

So, I'm happy with the changes outside of demux.go... I think what's in demux.go will work but it's more complicated than is necessary and the repeated copying of the channel slice on the mainline demux path is less than optimal.

Maybe take a step back and look at that again?</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 11:47:13 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 12:29:30 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)

The copy is of pointers, so it should end up being essentially a memcpy which should be pretty fast, and only on entry, not while doing the actual send. I think we're holding the lock for as short as possible there.
I'll take another look, but I'm not sure what I'll be able to do.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 12:34:13 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> The copy is of pointers, so it should end up being essentially a memcpy which should be pretty fast, and only on entry, not while doing the actual send. I think we're holding the lock for as short as possible there.

+1</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 12:43:44 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> Patch Set 8:
> 
> > The copy is of pointers, so it should end up being essentially a memcpy which should be pretty fast, and only on entry, not while doing the actual send. I think we're holding the lock for as short as possible there.
> 
> +1

it's an alloc of an escaping reference and a copy</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 12:44:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:47:40 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13895/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:48:03 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:53:31 PM<br><strong>Message</strong>: <pre>Patch Set 9: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:54:17 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13895/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13895</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:55:41 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12284/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:55:57 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8877/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:56:05 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 12:56:19 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 1:23:36 PM<br><strong>Message</strong>: <pre>Patch Set 9: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 1:33:37 PM<br><strong>Message</strong>: <pre>Patch Set 9: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 1:34:16 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8877/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8877

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12284/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12284</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 2:51:45 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Added a CR to the stack to move the slice allocation from DeMux to Add.

https://gerrit.hyperledger.org/r/c/fabric/+/31492</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 2:52:22 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Run IntegrationTest

panic: Failed to create chaincode server: listen tcp 0.0.0.0:36004: bind: address already in use</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 2:52:28 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 2:56:57 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8886/</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 2:57:14 PM<br><strong>Message</strong>: <pre>Patch Set 9:

A slice trick removes all the allocation in that path.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 2:57:19 PM<br><strong>Message</strong>: <pre>Patch Set 9: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 3:08:23 PM<br><strong>Message</strong>: <pre>Patch Set 9:

here is the results of the next change 
https://gist.github.com/MHBauer/64c31080fcbcfd004f1bb8665f20df5c 
test data was generated from 
go test -count 10000 -failfast -memprofile mem.out -run TestChannelDeMultiplexer</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 3:10:24 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 3:12:28 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:12:36 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13911/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:12:56 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 3:14:31 PM<br><strong>Message</strong>: <pre>Patch Set 9:

> it's an alloc of an escaping reference and a copy

I see the alloc/copy, it is the 'make ()' call.

I don't see the escape. 


From talking it out, we should probably be optimizing the demultiplex call rather than the AddChannel call. That is the one in the hot loop of processing gossip messages.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:18:01 PM<br><strong>Message</strong>: <pre>Patch Set 10: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:18:41 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13911/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13911</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:18:49 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8886/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8886</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:20:31 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12295/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:20:57 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:21:21 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8888/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:21:47 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:23:23 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:49:25 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 3:50:11 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8888/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8888

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12295/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12295</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 5:28:40 PM<br><strong>Message</strong>: <pre>Patch Set 10:

not sure what to do about the test failure.

but also, why are we using alpine and not the default golang?</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 5:57:31 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Run IntegrationTest

15:23:17 ERROR: Failed to create usr/libexec/gcc/x86_64-alpine-linux-musl/8.3.0/cc1obj: I/O error
15:23:17 ERROR: gcc-8.3.0-r0: IO ERROR</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 6:00:06 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8894/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 6:00:39 PM<br><strong>Message</strong>: <pre>Patch Set 10: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 6:38:16 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 6:39:05 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8894/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8894</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 7:31:42 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review-1

Lets make this more formal. The slice allocation should not be on the mainline path.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 8:01:38 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)

> Lets make this more formal. The slice allocation should not be on
 > the mainline path.

It's a slice ref, which is two ints and a pointer that ought to be stack allocated.

If the AddChannel overflows resulting in a copy to a larger buffer, the original slice still exists and will be abandoned when no references are left.

I'm pretty sure this is not allocating during demux. The profiler says so as well.
I think this is the same conditions https://play.golang.org/p/ZAr_GkjYq9q

What is the suggested change?</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/22/2019, 8:05:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:09:21 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13917/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:09:51 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:16:07 PM<br><strong>Message</strong>: <pre>Patch Set 11: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:16:53 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13917/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13917</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:19:53 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12305/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:20:22 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8897/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:20:24 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:20:47 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 8:54:36 PM<br><strong>Message</strong>: <pre>Patch Set 11: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 9:00:17 PM<br><strong>Message</strong>: <pre>Patch Set 11: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/22/2019, 9:00:58 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12305/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12305

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8897/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8897</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/23/2019, 1:14:23 PM<br><strong>Message</strong>: <pre>Uploaded patch set 12: Patch Set 11 was rebased.</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/23/2019, 1:27:10 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Run IntegrationTest

00:28:26.626 	panic: failed to start couchDB: database in container 885f61e9a05093104441aada542cbbae5bb6f64e0e2e96cfc59332e4869c80e2 did not start: context deadline exceeded
00:28:26.626 
00:28:26.626 goroutine 2148 [running]:
00:28:26.626 testing.tRunner.func1(0xc0004e0100)
00:28:26.626 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:830 +0x69d
00:28:26.626 panic(0x15916c0, 0xc000ec81d0)
00:28:26.626 	/opt/go/go1.12.5.linux.amd64/src/runtime/panic.go:522 +0x1b5
00:28:26.626 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).setupCouch(0x22e42a0, 0x1, 0x3)
00:28:26.626 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:110 +0x4a1
00:28:26.626 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).Init(0x22e42a0, 0x186c4e0, 0xc0004e0100)
00:28:26.626 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:122 +0xcc
00:28:26.626 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.testGetStateRangeScanIterator(0xc0004e0100, 0x185b2c0, 0x22e42a0)
00:28:26.626 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/db_test.go:183 +0x76
00:28:26.626 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.TestGetStateRangeScanIterator.func1(0xc0004e0100)
00:28:26.626 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/db_test.go:177 +0x6b
00:28:26.626 testing.tRunner(0xc0004e0100, 0xc000502020)
00:28:26.626 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:865 +0x164
00:28:26.626 created by testing.(*T).Run
00:28:26.626 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:916 +0x65b
00:28:26.626 FAIL	github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate	80.411s</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 1:30:59 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8912/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 1:31:31 PM<br><strong>Message</strong>: <pre>Patch Set 12: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:05:44 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:06:24 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8912/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8912</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 5/23/2019, 2:20:51 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Run UnitTest

oops, same as before, I didn't realize it was unit</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:25:06 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12323/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:25:30 PM<br><strong>Message</strong>: <pre>Patch Set 12: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:54:06 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2019, 2:54:46 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12323/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12323</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/23/2019, 5:18:57 PM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2

copy is gone</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 5/24/2019, 8:09:05 AM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 5/24/2019, 8:09:08 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Gari Singh</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 8:10:50 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6723/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 8:11:13 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5407/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/24/2019, 8:35:54 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6723/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6723

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5407/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5407</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1557899566<br><strong>GitHubRevision</strong>: [b78b1c0a3cc9009925fcac2c4e4f1db687cce384](https://github.com/hyperledger/fabric/commit/b78b1c0a3cc9009925fcac2c4e4f1db687cce384)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 2:02:37 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 2:02:37 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 2:45:15 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 10:08:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/15/2019, 4:26:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1557954978<br><strong>GitHubRevision</strong>: [9b472cc6d68280b247962b50cd4b758e2fbbf6c2](https://github.com/hyperledger/fabric/commit/9b472cc6d68280b247962b50cd4b758e2fbbf6c2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 5:23:36 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 5:23:36 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 6:02:39 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/15/2019, 5:52:49 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1557955067<br><strong>GitHubRevision</strong>: [e6fdb56d69ef4e2b2f3b3ca2e0b2672eae5e0ce7](https://github.com/hyperledger/fabric/commit/e6fdb56d69ef4e2b2f3b3ca2e0b2672eae5e0ce7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 9:21:26 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 9:21:26 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 10:00:24 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 9:50:33 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558394576<br><strong>GitHubRevision</strong>: [191a2f1ad363989ad9a6642fc650d02215d62d58](https://github.com/hyperledger/fabric/commit/191a2f1ad363989ad9a6642fc650d02215d62d58)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 7:28:09 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 7:28:09 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 8:08:51 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 7:56:15 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558479532<br><strong>GitHubRevision</strong>: [844d80e70574f325c4ab38f839961f1851731194](https://github.com/hyperledger/fabric/commit/844d80e70574f325c4ab38f839961f1851731194)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 7:06:10 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558479880<br><strong>GitHubRevision</strong>: [c23bc18f715bbc9c9bfe55800fe1b2b9787dd266](https://github.com/hyperledger/fabric/commit/c23bc18f715bbc9c9bfe55800fe1b2b9787dd266)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 7:14:47 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 7:14:47 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 8:05:10 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 7:42:48 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558484507<br><strong>GitHubRevision</strong>: [1661627853593ce38e1304efd444083aab90f7c6](https://github.com/hyperledger/fabric/commit/1661627853593ce38e1304efd444083aab90f7c6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 8:32:22 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 8:32:22 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 9:14:47 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 9:03:31 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/22/2019, 2:36:13 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558536514<br><strong>GitHubRevision</strong>: [5e9f22b8ed1ba40430bfc1c82fe634a2c88a7fd2](https://github.com/hyperledger/fabric/commit/5e9f22b8ed1ba40430bfc1c82fe634a2c88a7fd2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 10:56:48 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 10:56:48 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 11:36:53 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 11:30:01 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558543456<br><strong>GitHubRevision</strong>: [ca8495b09696fda2c396de87ad5ef385d857a090](https://github.com/hyperledger/fabric/commit/ca8495b09696fda2c396de87ad5ef385d857a090)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 12:53:31 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 12:53:31 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 1:23:36 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 3:18:49 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/22/2019, 3:10:24 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/22/2019, 2:52:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558552348<br><strong>GitHubRevision</strong>: [b0b3d6d7070dc981fc036abb3f86dce958d9b563](https://github.com/hyperledger/fabric/commit/b0b3d6d7070dc981fc036abb3f86dce958d9b563)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 3:18:01 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 3:18:01 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 6:38:16 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 3:49:25 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/22/2019, 7:31:42 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558569913<br><strong>GitHubRevision</strong>: [9ca00884dcfea4bbab40ee9c5d71506a3fd877db](https://github.com/hyperledger/fabric/commit/9ca00884dcfea4bbab40ee9c5d71506a3fd877db)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 8:16:07 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 8:16:07 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 9:00:17 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 8:54:36 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Uploader</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Created</strong>: 1558631663<br><strong>GitHubRevision</strong>: [2181eb1473b5fee8e343a66c53a62a48ec825776](https://github.com/hyperledger/fabric/commit/2181eb1473b5fee8e343a66c53a62a48ec825776)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 8:16:07 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/22/2019, 8:16:07 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 2:05:44 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2019, 2:54:06 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 5/24/2019, 8:09:05 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Gari Singh<br><strong>Merged</strong>: 5/24/2019, 8:09:08 AM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/23/2019, 5:18:57 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>