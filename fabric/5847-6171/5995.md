<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 5995<br><strong>Subject</strong>: [FAB-2243] Replace Tx Validation bit-array by flags<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/14/2017, 7:59:18 AM<br><strong>LastUpdated</strong>: 2/27/2017, 11:56:58 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-2243] Replace Tx Validation bit-array by flags

https://jira.hyperledger.org/browse/FAB-2243

Switch valid flag from a boolean to an enum, so that we can indicate the reason
for the invalidation (txid already exists, vscc validation failure
(endorsement policy failure), mvcc validation failure, etc)

This change adds invalidation reason codes, sets them in the block as a uint8
(byte) array, and returns validation result in GetTransactionById.

Change-Id: I3593bf6aa4f35bb01b14f8fb3d9950b405f84660
Signed-off-by: Ruslan Kryukov <ruslan.kryukov@ru.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/14/2017, 7:59:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2017, 8:02:51 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6952/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2017, 8:08:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6952/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/14/2017, 8:16:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2017, 8:20:02 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6953/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2017, 9:27:55 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6953/ : SUCCESS</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/14/2017, 12:40:20 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Hi, thank you for contribution. Could you please open a JIRA item and elaborate on the change?</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/15/2017, 12:47:09 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(9 comments)

Hi Ruslan, thanks for the CR. Please see comments.. mainly around the new type (TxValidationFlags) that you introduced.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 3:04:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 3:05:30 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6994/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 3:10:08 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6994/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 3:16:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 3:19:48 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6997/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 3:23:23 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6997/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 5:45:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 5:46:21 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6998/</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 5:49:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 5:52:06 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6999/</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 5:55:40 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 5:58:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

> Hi, thank you for contribution. Could you please open a JIRA item
 > and elaborate on the change?

Hi, I'm glad to hear that. I've opened JIRA task and made changes which have been suggested by Manish Sethi</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 5:59:13 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6998/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 5:59:33 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7000/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 6:02:17 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6999/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 6:09:19 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7000/ : FAILURE</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/15/2017, 7:06:27 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 9:32:36 AM<br><strong>Message</strong>: <pre>Patch Set 7:

> (1 comment)
>Do you think that there would be an issue if you just have following?
I implemented like that, but I was faced with problem, that flags array was empty in some situations.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/15/2017, 11:03:47 AM<br><strong>Message</strong>: <pre>Patch Set 7:

I am not sure if I understood your comment. Can you please elaborate what was the situation and what issue you were facing.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 1:51:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 1:56:01 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7033/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2017, 2:04:52 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7033/ : FAILURE</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/15/2017, 11:27:55 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Ruslan, please describe the motivation in the commit message.

Binh, are you agreeable if we change the tran validation bit array to a unit8 array? This way the value can indicate an invalidation reason code, e.g. txid already exists, vscc validation failure (endorsement policy failure), mvcc validation failure, etc.  0 would be valid and the various invalidation reason codes could start at 1.  I expect most clients and auditors would want to know why it got invalidated.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 2:41:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2017, 2:45:26 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7047/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2017, 2:55:07 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7047/ : FAILURE</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2017, 4:53:43 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 6:55:41 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> (1 comment)

 If we don't use pointer then the struct pointer won't be reassigned to new instance of array. That's why we should use pointer.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2017, 7:12:29 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> > (1 comment)
 > 
 > If we don't use pointer then the struct pointer won't be reassigned
 > to new instance of array. That's why we should use pointer.

slices and string variables are always pointers implicitly in golang... 

I don't know what you meant by `reassigned`. In your code, you are actually resolving these pointers in you function code... What's the point of declaring the method on a pointer when you have to resolve this pointer in the function body.

I think that simplest would be just try the code that I suggested and let's see where you get stuck. Does this sound reasonable?</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 7:42:26 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> > > (1 comment)
 > >
 > > If we don't use pointer then the struct pointer won't be
 > reassigned
 > > to new instance of array. That's why we should use pointer.
 > 
 > slices and string variables are always pointers implicitly in
 > golang...
 > 
 > I don't know what you meant by `reassigned`. In your code, you are
 > actually resolving these pointers in you function code... What's
 > the point of declaring the method on a pointer when you have to
 > resolve this pointer in the function body.
 > 
 > I think that simplest would be just try the code that I suggested
 > and let's see where you get stuck. Does this sound reasonable?

I mean that example:
func (obj TxValidationFlags) SetFlag(i int, flag peer.TxValidationResult) {
	if uint(i) >= uint(len(obj)) {
		array := make(TxValidationFlags, uint(i)+1)
		copy(array, obj)
		obj = array
	}

	(obj)[i] = uint8(flag)
}

>obj = array
This line. Actually we doesn't assign array to method receiver 'obj' and if we call other method then len(obj) still be zero.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2017, 8:08:33 AM<br><strong>Message</strong>: <pre>Patch Set 9:

What I was suggesting is that we do not need dynamic expansion at all. We need to create this flag array either for a new block (in which case we know the size before hand) or we need to create it from already stored flags (in this case also we know the actual content).

Can you think of a situation which I may have missed... where this code for expansion would be used.

So, I was suggesting to avoid unnecessary complexity. For simplicity, think of it this way that we are dealing with []uint8 in our code straight... just an alias is defined for readability. More than that would be unnecessary in my opinion.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 8:37:16 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> What I was suggesting is that we do not need dynamic expansion at
 > all. We need to create this flag array either for a new block (in
 > which case we know the size before hand) or we need to create it
 > from already stored flags (in this case also we know the actual
 > content).
 > 
 > Can you think of a situation which I may have missed... where this
 > code for expansion would be used.
 > 
 > So, I was suggesting to avoid unnecessary complexity. For
 > simplicity, think of it this way that we are dealing with []uint8
 > in our code straight... just an alias is defined for readability.
 > More than that would be unnecessary in my opinion.

When we run test core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator_test.go

it calls inside method ValidateAndPrepareBatch. Inside method contains instruction:
txsFilter := util.TxValidationFlags(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER])

sizeof(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER]) == 0

When filter is created, he has size 0.

BUT some lines below we have:
txsFilter.SetFlag(txIndex, peer.TxValidationResult_INVALID)

Go has panic: out of range cuz txIndex > len(txsFilter)

So, test is failed.

If we use array with expand function, result of test will be success.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2017, 8:52:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> > What I was suggesting is that we do not need dynamic expansion at
 > > all. We need to create this flag array either for a new block (in
 > > which case we know the size before hand) or we need to create it
 > > from already stored flags (in this case also we know the actual
 > > content).
 > >
 > > Can you think of a situation which I may have missed... where
 > this
 > > code for expansion would be used.
 > >
 > > So, I was suggesting to avoid unnecessary complexity. For
 > > simplicity, think of it this way that we are dealing with []uint8
 > > in our code straight... just an alias is defined for readability.
 > > More than that would be unnecessary in my opinion.
 > 
 > When we run test core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator_test.go
 > 
 > it calls inside method ValidateAndPrepareBatch. Inside method
 > contains instruction:
 > txsFilter := util.TxValidationFlags(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER])
 > 
 > sizeof(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER])
 > == 0
 > 
 > When filter is created, he has size 0.
 > 
 > BUT some lines below we have:
 > txsFilter.SetFlag(txIndex, peer.TxValidationResult_INVALID)
 > 
 > Go has panic: out of range cuz txIndex > len(txsFilter)
 > 
 > So, test is failed.
 > 
 > If we use array with expand function, result of test will be
 > success.

Please replace the line that you pointed out `txsFilter := util.TxValidationFlags(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER])` by the following
txsFilter := NewTxValidationFlags(len(block.Data.Data))</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 9:01:07 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> Please replace the line that you pointed out `txsFilter :=
 > util.TxValidationFlags(block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER])`
 > by the following
 > txsFilter := NewTxValidationFlags(len(block.Data.Data))

But If we replace that, current flags of the block will be stolen. Few line below we check this flags with function: txsFilter.IsSetTo</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 9:04:11 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Only this test stops me from changing txvalidationflags.go</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 9:15:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

State_based_validator are used in a commiter before commit block to a ledger. Flags of block are populated in txvalidator in commiter. It means that in state_based_validator we already have filled 

block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER]

array and if we recreate this array with empty values like (TxValiationFlags(<SIZE>)) it will be wrong decision.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2017, 9:19:37 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Yes, I understand what is happening now. Actually, the code that you pointed out, would already have the array pre-filled by the `core/committer/txvalidator/validator.go`. (I hope that you would have modified that code as well)

For the unit test, you can add this array in the test itself so that the block in the ValidateAndPrepare function already has this array in place.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 9:32:46 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 9:33:49 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> Yes, I understand what is happening now. Actually, the code that
 > you pointed out, would already have the array pre-filled by the
 > `core/committer/txvalidator/validator.go`. (I hope that you would
 > have modified that code as well)
 > 
 > For the unit test, you can add this array in the test itself so
 > that the block in the ValidateAndPrepare function already has this
 > array in place.

Okay, good, now test works fine :)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2017, 9:37:10 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7057/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2017, 10:00:34 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7057/ : FAILURE</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/16/2017, 5:06:41 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(2 comments)

Anybody know why the verification is failing?

Ruslan, anything else need to be added here?  We are trying to freeze the proto updates as soon as possible.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/17/2017, 3:02:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 3:05:01 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7105/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 3:15:10 AM<br><strong>Message</strong>: <pre>Patch Set 11: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7105/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/17/2017, 3:15:44 AM<br><strong>Message</strong>: <pre>Patch Set 9:

> (2 comments)
 > 
 > Anybody know why the verification is failing?
 > 
 > Ruslan, anything else need to be added here?  We are trying to
 > freeze the proto updates as soon as possible.

I think no, but, for example, I can extend list of validation flags.

Strange error:
ERROR: for unit-tests  Cannot start service unit-tests: Cannot link to a non running container: /unittest_vp_1 AS /unittest_unit-tests_1/unittest_vp_1
Encountered errors while bringing up the project.
Makefile:105: recipe for target 'unit-test' failed
make: *** [unit-test] Error 1
Build step 'Execute shell' marked build as failure
[ssh-agent] Stopped.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/17/2017, 3:51:16 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 3:55:07 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7109/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 4:03:52 AM<br><strong>Message</strong>: <pre>Patch Set 12: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7109/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/17/2017, 4:31:41 AM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 4:35:07 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7111/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2017, 4:45:48 AM<br><strong>Message</strong>: <pre>Patch Set 13: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7111/ : FAILURE</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/17/2017, 7:24:51 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Ramesh, Greg, Chris,
Do you have any thoughts on why Verification would be failing for this one?  I haven't seen that error before.</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/18/2017, 10:41:24 AM<br><strong>Message</strong>: <pre>Patch Set 13:

> Ramesh, Greg, Chris,
 > Do you have any thoughts on why Verification would be failing for
 > this one?  I haven't seen that error before.

It lools like network failure?
09:45:38 ERROR: for unit-tests  Cannot start service unit-tests: Cannot link to a non running container: /unittest_vp_1 AS /unittest_unit-tests_1/vp_1
09:45:38 Encountered errors while bringing up the project.
09:45:38 Makefile:105: recipe for target 'unit-test' failed</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/18/2017, 10:41:47 AM<br><strong>Message</strong>: <pre>Patch Set 13:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 10:41:59 AM<br><strong>Message</strong>: <pre>Patch Set 13: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2807/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 10:43:46 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7172/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 10:51:34 AM<br><strong>Message</strong>: <pre>Patch Set 13: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2807/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7172/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/18/2017, 12:03:49 PM<br><strong>Message</strong>: <pre>Patch Set 13:

> > Ramesh, Greg, Chris,
 > > Do you have any thoughts on why Verification would be failing for
 > > this one?  I haven't seen that error before.
 > 
 > It lools like network failure?
 > 09:45:38 ERROR: for unit-tests  Cannot start service unit-tests:
 > Cannot link to a non running container: /unittest_vp_1 AS
 > /unittest_unit-tests_1/vp_1
 > 09:45:38 Encountered errors while bringing up the project.
 > 09:45:38 Makefile:105: recipe for target 'unit-test' failed

I have same error message if run it locally on my pc</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/18/2017, 2:48:03 PM<br><strong>Message</strong>: <pre>Uploaded patch set 14.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 2:48:12 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2826/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 2:51:22 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7191/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 3:15:03 PM<br><strong>Message</strong>: <pre>Patch Set 14: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2826/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7191/ : FAILURE</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/18/2017, 4:04:53 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Latest failures will be fixed by:
https://gerrit.hyperledger.org/r/#/c/6225/</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/18/2017, 5:15:57 PM<br><strong>Message</strong>: <pre>Uploaded patch set 15.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 5:16:03 PM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2834/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 5:19:18 PM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7199/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2017, 6:34:43 PM<br><strong>Message</strong>: <pre>Patch Set 15: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/2834/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7199/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 1:16:11 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(8 comments)

I highlighted important validation reason codes that are needed in the code.  If some of the comments will be addressed in subsequent changeset so that you can get this one in, that's fine, but mention in the commit message which aspects this changeset covers and which aspects will be in future changesets.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 4:20:12 AM<br><strong>Message</strong>: <pre>Uploaded patch set 16.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 4:20:24 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2844/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 4:21:03 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7209/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 4:42:21 AM<br><strong>Message</strong>: <pre>Patch Set 16: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2844/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7209/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 5:42:21 AM<br><strong>Message</strong>: <pre>Patch Set 16:

I've found some bugs.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 5:53:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 17.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 5:53:49 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2851/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 5:56:17 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7216/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 5:59:16 AM<br><strong>Message</strong>: <pre>Patch Set 17: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2851/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7216/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 6:38:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 18.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 6:38:25 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2853/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 6:39:59 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7218/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 7:12:58 AM<br><strong>Message</strong>: <pre>Patch Set 18: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2853/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7218/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 8:08:24 AM<br><strong>Message</strong>: <pre>Uploaded patch set 19: Patch Set 18 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 8:08:31 AM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2860/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 8:11:51 AM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7225/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 8:44:29 AM<br><strong>Message</strong>: <pre>Patch Set 19: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2860/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7225/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 10:11:46 AM<br><strong>Message</strong>: <pre>Uploaded patch set 20.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 10:11:53 AM<br><strong>Message</strong>: <pre>Patch Set 20:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2886/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 10:15:28 AM<br><strong>Message</strong>: <pre>Patch Set 20:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7251/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 10:54:22 AM<br><strong>Message</strong>: <pre>Patch Set 20: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2886/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7251/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 11:10:50 AM<br><strong>Message</strong>: <pre>Uploaded patch set 21.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:10:59 AM<br><strong>Message</strong>: <pre>Patch Set 21:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2889/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:14:19 AM<br><strong>Message</strong>: <pre>Patch Set 21:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7254/ (2/2)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 11:15:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 22.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:15:34 AM<br><strong>Message</strong>: <pre>Patch Set 22:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2890/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:19:20 AM<br><strong>Message</strong>: <pre>Patch Set 22:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7255/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:42:38 AM<br><strong>Message</strong>: <pre>Patch Set 21: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2889/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7254/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 11:46:04 AM<br><strong>Message</strong>: <pre>Patch Set 22: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2890/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7255/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 12:21:43 PM<br><strong>Message</strong>: <pre>Uploaded patch set 23.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:21:50 PM<br><strong>Message</strong>: <pre>Patch Set 23:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2896/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:25:41 PM<br><strong>Message</strong>: <pre>Patch Set 23:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7261/ (2/2)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 12:27:31 PM<br><strong>Message</strong>: <pre>Uploaded patch set 24.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:27:40 PM<br><strong>Message</strong>: <pre>Patch Set 24:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2897/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:30:28 PM<br><strong>Message</strong>: <pre>Patch Set 24:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7262/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:47:41 PM<br><strong>Message</strong>: <pre>Patch Set 23: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2896/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7261/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2017, 12:55:56 PM<br><strong>Message</strong>: <pre>Patch Set 24: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2897/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7262/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 1:01:31 PM<br><strong>Message</strong>: <pre>Patch Set 24:

Muralisr, Manish, guys, can you help me with verification? Unit-test is failed with a strange error</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/19/2017, 1:55:15 PM<br><strong>Message</strong>: <pre>Patch Set 24:

Ruslan, "Could not get deployment transaction from LCCC for example02:0 " implies that the ledger entry to the LCCC chaincode is not found.

There are two RW sets at the end of a in instantiation of a chaincode on the ledger. (1) the RW set belonging to the user chaincode and (2) the RW set belonging to the LCCC chaincode registering the user chaincode.

I don't see any other errors before that error message which makes me think somehow the commit to the ledger at the end of the TX did not go through for (2) (and maybe (1) did not go through either).</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/19/2017, 1:59:47 PM<br><strong>Message</strong>: <pre>Patch Set 24:

By the way, you can just one test from the chaincode folder and see if solving that helps with others

cd core/chaincode
go test -ldflags "-X github.com/hyperledger/fabric/common/metadata.Version=0.7.0-snapshot-<get this from docker images> -run ExecuteInvokeTransaction</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/19/2017, 5:11:46 PM<br><strong>Message</strong>: <pre>Patch Set 24:

Ruslan, the snapshot id can be seen at the end of 'make peer'.  For me, this works:
go test -ldflags "-X github.com/hyperledger/fabric/common/metadata.Version=0.7.0-snapshot-19a1dce"  -run ExecuteDeployTransaction -v

but this one fails:
go test -ldflags "-X github.com/hyperledger/fabric/common/metadata.Version=0.7.0-snapshot-19a1dce"  -run ExecuteInvokeTransaction -v</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 4:47:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 25.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 4:47:31 AM<br><strong>Message</strong>: <pre>Patch Set 25:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2924/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 4:50:48 AM<br><strong>Message</strong>: <pre>Patch Set 25:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7289/ (2/2)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/20/2017, 4:54:45 AM<br><strong>Message</strong>: <pre>Uploaded patch set 26.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 4:54:57 AM<br><strong>Message</strong>: <pre>Patch Set 26:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2926/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 4:58:50 AM<br><strong>Message</strong>: <pre>Patch Set 26:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7291/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 5:34:09 AM<br><strong>Message</strong>: <pre>Patch Set 26: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2926/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7291/ : FAILURE</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 5:43:37 AM<br><strong>Message</strong>: <pre>Patch Set 26:

Ruslan, I had uploaded a patch (patch 25) for fixing the issues that were causing the tests failure. You reversed those in patch 26...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 6:11:01 AM<br><strong>Message</strong>: <pre>Patch Set 25: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/2924/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7289/ : SUCCESS</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/20/2017, 6:41:45 AM<br><strong>Message</strong>: <pre>Patch Set 26:

> Ruslan, I had uploaded a patch (patch 25) for fixing the issues
 > that were causing the tests failure. You reversed those in patch
 > 26...

Sorry, I didn't notice that and did it by mistake. Can you resubmit your patch? Thanks</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 6:51:07 AM<br><strong>Message</strong>: <pre>Patch Set 26:

Sure, no problem. Let me resubmit may patch that will fix the test failure issues. After that, I will post a few code review comment that you can fix and upload another patch.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 6:53:32 AM<br><strong>Message</strong>: <pre>Uploaded patch set 27.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 6:53:43 AM<br><strong>Message</strong>: <pre>Patch Set 27: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2932/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 6:57:29 AM<br><strong>Message</strong>: <pre>Patch Set 27:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7297/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 8:18:16 AM<br><strong>Message</strong>: <pre>Patch Set 27: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2932/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7297/ : SUCCESS</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 8:43:54 AM<br><strong>Message</strong>: <pre>Patch Set 27:

(15 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 8:47:08 AM<br><strong>Message</strong>: <pre>Patch Set 27:

Dave, the latest build passed for x86 but failed for z. One of the couchDB tests failed for the reason unrelated to this CR. Reverifying for now.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 8:47:21 AM<br><strong>Message</strong>: <pre>Patch Set 27:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 8:47:29 AM<br><strong>Message</strong>: <pre>Patch Set 27: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2937/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 8:50:03 AM<br><strong>Message</strong>: <pre>Patch Set 27:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7302/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2017, 9:47:32 AM<br><strong>Message</strong>: <pre>Patch Set 27: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/2937/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7302/ : SUCCESS</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/20/2017, 10:41:37 AM<br><strong>Message</strong>: <pre>Patch Set 27:

>we can return -1 (instead of NOT_DEFINED) for these cases.
Please remove NOT_DEFINED. Why would peer ever set this in the array?
In my opinion, NOT_DEFINED gives more information then just -1... And if we call a method with incorrect txIndex, it would be better to return NOT_DEFINED instead of panic 'index out of range'. I understand, in this case I suppress exception, but....


>INVALID does not make sense - when we have detailed codes for various causes of invalid

INVALID is default v-code in the beginning of block validation in validator.go. We can't just remove him.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 11:24:58 AM<br><strong>Message</strong>: <pre>Patch Set 27:

> >we can return -1 (instead of NOT_DEFINED) for these cases.
 > Please remove NOT_DEFINED. Why would peer ever set this in the
 > array?
 > In my opinion, NOT_DEFINED gives more information then just -1...
 > And if we call a method with incorrect txIndex, it would be better
 > to return NOT_DEFINED instead of panic 'index out of range'. I
 > understand, in this case I suppress exception, but....
 > 
 > 
 > >INVALID does not make sense - when we have detailed codes for
 > various causes of invalid
 > 
 > INVALID is default v-code in the beginning of block validation in
 > validator.go. We can't just remove him.

if someone queries for transaction status with wrong txID, it's much cleaner to return an error "txID not found" rather than returning the transaction status as NOT_DEFINED.

If I understand your argument for INVALID correctly, it will never be returned but you have it and use as a temp initialization in internal code. If my understanding is correct, proto file (and exposing this outside) is not the right place for these. Is there a problem if you initialize with any code? At the end we either need to set VALID or one of REASONs...</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/20/2017, 11:43:09 AM<br><strong>Message</strong>: <pre>Patch Set 27:

"it would be better to return NOT_DEFINED instead of panic 'index out of range'. I understand, in this case I suppress exception, but...."

Suppressing "index out of range" is not good. In fact, this was the reason for your tests failure and catching second order of bug that it causes becomes a nightmare.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 2:31:08 AM<br><strong>Message</strong>: <pre>Patch Set 27:

> "it would be better to return NOT_DEFINED instead of panic 'index
 > out of range'. I understand, in this case I suppress exception,
 > but...."
 > 
 > Suppressing "index out of range" is not good. In fact, this was the
 > reason for your tests failure and catching second order of bug that
 > it causes becomes a nightmare.

Hah, You're right, okay, have persuaded me</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 4:12:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 28.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 4:12:29 AM<br><strong>Message</strong>: <pre>Patch Set 28:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2983/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 4:16:34 AM<br><strong>Message</strong>: <pre>Patch Set 28:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7348/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 5:43:48 AM<br><strong>Message</strong>: <pre>Patch Set 28: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/2983/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7348/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 6:32:25 AM<br><strong>Message</strong>: <pre>Uploaded patch set 29.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 6:32:35 AM<br><strong>Message</strong>: <pre>Patch Set 29:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/2994/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 6:36:44 AM<br><strong>Message</strong>: <pre>Patch Set 29:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7359/ (2/2)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/21/2017, 6:49:51 AM<br><strong>Message</strong>: <pre>Patch Set 28:

(8 comments)

Ruslan, I still see that this CR still does not address all the comments that I had made on the patch 27. Here are some additional clarifications on some of the pending comments. May be you are making changes in pieces... if this is that case, it would be helpful if you can add WIP (work in progress in the commit message) and remove that when you submit the patch with final changes - thanks.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2017, 7:54:48 AM<br><strong>Message</strong>: <pre>Patch Set 29: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/2994/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7359/ : SUCCESS</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 7:58:24 AM<br><strong>Message</strong>: <pre>Patch Set 29:

> (8 comments)
 > 
 > Ruslan, I still see that this CR still does not address all the
 > comments that I had made on the patch 27. Here are some additional
 > clarifications on some of the pending comments. May be you are
 > making changes in pieces... if this is that case, it would be
 > helpful if you can add WIP (work in progress in the commit message)
 > and remove that when you submit the patch with final changes -
 > thanks.

I think we can do this refactoring indefinitely.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 8:04:26 AM<br><strong>Message</strong>: <pre>Patch Set 29:

If this CR has no deadline, okay, I keep on doing that</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 8:06:45 AM<br><strong>Message</strong>: <pre>Patch Set 29:

Thanks Ruslan.  There are a finite number of comments remaining, let's do those and then call this one complete.  If you want to defer certain pieces to a subsequent changeset for whatever reason, put a TODO comment in the code that changes are coming in subsequent changeset, so that the final reviews understand.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 8:15:06 AM<br><strong>Message</strong>: <pre>Patch Set 29:

> Thanks Ruslan.  There are a finite number of comments remaining,
 > let's do those and then call this one complete.  

No problem, I complete them today or tomorrow, at most.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 12:34:14 PM<br><strong>Message</strong>: <pre>Patch Set 29:

Ruslan, deadline is this week, preferably sooner than later.</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/21/2017, 4:31:09 PM<br><strong>Message</strong>: <pre>Patch Set 29:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2017, 5:44:06 PM<br><strong>Message</strong>: <pre>Patch Set 29:

Ruslan, in case you didnt notice, a rebase will be needed to resolve the merge conflicts.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/22/2017, 4:07:40 AM<br><strong>Message</strong>: <pre>Uploaded patch set 30.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2017, 4:07:49 AM<br><strong>Message</strong>: <pre>Patch Set 30:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/3039/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2017, 4:08:35 AM<br><strong>Message</strong>: <pre>Patch Set 30:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7403/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2017, 5:18:08 AM<br><strong>Message</strong>: <pre>Patch Set 30: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/3039/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7403/ : SUCCESS</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/22/2017, 7:11:01 AM<br><strong>Message</strong>: <pre>Patch Set 30:

> (8 comments)
 > 
 > Ruslan, I still see that this CR still does not address all the
 > comments that I had made on the patch 27. Here are some additional
 > clarifications on some of the pending comments. May be you are
 > making changes in pieces... if this is that case, it would be
 > helpful if you can add WIP (work in progress in the commit message)
 > and remove that when you submit the patch with final changes -
 > thanks.

I have done almost all comments.. but may be skipped something by mistake...
Also

>core/common/validation/msgvalidation.go
Line 369:
Will error be always because of this reason? See comment in line 349

I saw code and noticed that ValidationCode for now is same, but error messages are different. I think we shouldnt pass nil instead of err cuz err can be printed to log.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/23/2017, 12:18:31 AM<br><strong>Message</strong>: <pre>Patch Set 30:

Hi Ruslan, as discussed - can you please update the status of the individual comments to the previous patches.
This would give you a chance to review yourself if something is left out (e.g., I quickly glanced and see the comments are still missing for the exported functions in txvalidationflags.go).
Also, it would be helpful for the reviewers.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/23/2017, 3:45:00 AM<br><strong>Message</strong>: <pre>Patch Set 30:

(21 comments)

Done</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/23/2017, 4:50:26 AM<br><strong>Message</strong>: <pre>Patch Set 30:

(5 comments)

Hi Ruslan, overall looks quite well now. Just a few minor things needs to be finished. Please see the comments below.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/23/2017, 6:01:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 31.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/23/2017, 6:02:00 AM<br><strong>Message</strong>: <pre>Patch Set 31:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/3133/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/23/2017, 6:05:33 AM<br><strong>Message</strong>: <pre>Patch Set 31:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7499/ (2/2)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/23/2017, 7:08:23 AM<br><strong>Message</strong>: <pre>Patch Set 31:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/23/2017, 7:58:02 AM<br><strong>Message</strong>: <pre>Patch Set 31: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/3133/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7499/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/23/2017, 11:48:25 AM<br><strong>Message</strong>: <pre>Patch Set 31:

Ruslan, just make sure you run govet, golint, and goimports as documented here
http://hyperledger-fabric.readthedocs.io/en/latest/Style-guides/go-style/

It would help fix all these style issues</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/23/2017, 2:07:57 PM<br><strong>Message</strong>: <pre>Patch Set 31:

(2 comments)

Fixed

Also I've checked all my changed files with Jetbrains Gogland analyser and fixed almost issues.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/23/2017, 6:48:36 PM<br><strong>Message</strong>: <pre>Patch Set 31:

(8 comments)

I was hoping since Manish's comments were addressed that we would be done here, but I have some remaining comments.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/24/2017, 5:37:58 AM<br><strong>Message</strong>: <pre>Patch Set 31:

(2 comments)

Added two more minor comments.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/24/2017, 5:44:09 AM<br><strong>Message</strong>: <pre>Patch Set 31:

(2 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/24/2017, 5:52:12 AM<br><strong>Message</strong>: <pre>Patch Set 31:

(2 comments)</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/26/2017, 11:19:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 32.</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/26/2017, 11:21:15 AM<br><strong>Message</strong>: <pre>Patch Set 31:

(11 comments)

Check  that.

(Sorry I'm late, we had holidays in Russia)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/26/2017, 11:22:29 AM<br><strong>Message</strong>: <pre>Patch Set 32:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7717/</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/26/2017, 12:31:44 PM<br><strong>Message</strong>: <pre>Patch Set 32:

Thanks Ruslan.  There is also a merge conflict now, a rebase is needed.
If you are not able to get to it today, I can make final updates tonight.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/26/2017, 12:39:35 PM<br><strong>Message</strong>: <pre>Patch Set 32: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7717/ : SUCCESS</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 2:46:11 AM<br><strong>Message</strong>: <pre>Uploaded patch set 33.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 2:47:12 AM<br><strong>Message</strong>: <pre>Patch Set 33:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7745/</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 2:48:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 34.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 2:51:05 AM<br><strong>Message</strong>: <pre>Patch Set 34:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7746/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 2:51:18 AM<br><strong>Message</strong>: <pre>Patch Set 33: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7745/ : FAILURE</pre><strong>Reviewer</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 3:42:14 AM<br><strong>Message</strong>: <pre>Patch Set 34:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 3:45:39 AM<br><strong>Message</strong>: <pre>Patch Set 34:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7748/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 4:08:39 AM<br><strong>Message</strong>: <pre>Patch Set 34: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7746/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 5:17:34 AM<br><strong>Message</strong>: <pre>Patch Set 34:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7748/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 5:30:13 AM<br><strong>Message</strong>: <pre>Uploaded patch set 35.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 5:31:09 AM<br><strong>Message</strong>: <pre>Patch Set 35:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7751/</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 5:32:20 AM<br><strong>Message</strong>: <pre>Patch Set 35: Code-Review+1

Ruslan, I did some minor clean up.  We're done here. LGTM.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/27/2017, 6:47:44 AM<br><strong>Message</strong>: <pre>Patch Set 35: Code-Review+1</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 6:58:27 AM<br><strong>Message</strong>: <pre>Patch Set 35: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7751/ : SUCCESS</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 2/27/2017, 8:31:14 AM<br><strong>Message</strong>: <pre>Patch Set 35: Code-Review+1

Looks OK but it is a bit bigger than the usual so I will have another look. :)</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 2/27/2017, 9:45:19 AM<br><strong>Message</strong>: <pre>Patch Set 35: Code-Review+2

NOTE that this patch is far too large. There are multiple changes included, and this certainly could have been carved up. Please, Please keep changes under 250 LOC per the guidelines. This is getting old.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/27/2017, 10:32:43 AM<br><strong>Message</strong>: <pre>Patch Set 35: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 10:32:46 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Srinivasan Muralidharan</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 10:35:21 AM<br><strong>Message</strong>: <pre>Patch Set 35:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1204/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 11:56:58 AM<br><strong>Message</strong>: <pre>Patch Set 35:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1204/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/14/2017, 7:59:18 AM<br><strong>UnmergedRevision</strong>: [2738c4762a100f1a60a7c033a821b79ab0bf3293](https://github.com/hyperledger-gerrit-archive/fabric/commit/2738c4762a100f1a60a7c033a821b79ab0bf3293)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/14/2017, 8:08:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/14/2017, 8:16:30 AM<br><strong>UnmergedRevision</strong>: [65522a9444b43dc49f077becbe7cc93b454a155c](https://github.com/hyperledger-gerrit-archive/fabric/commit/65522a9444b43dc49f077becbe7cc93b454a155c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/14/2017, 9:27:55 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>I think that we just need following three methods in this file - NewTxValidationFlags, SetFlag, and Flag. 

Additionally, You may keep functions NewTxValidationFlagsFromBytes, and IsSet, if you will.

please see the detailed comments in-lined below.

Also, it would be nice to not use `ba` anymore as this is not longer a bitarray... better to use flags?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L21)<br><strong>Comment</strong>: <pre>for clarity better to define it as []unit8?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L23)<br><strong>Comment</strong>: <pre>size+1 could be confusing.
you can simply return `make(TxValidationFlags, size)`</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L29)<br><strong>Comment</strong>: <pre>this is no more bitarray. this method can simply `return bytes`. For that matter, this method is not required. In code, we can simply write flags := TxValidationFlags(flagBytesRetrievdFromBlock).</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L34)<br><strong>Comment</strong>: <pre>better define functions for TxValidationFlags and not for *TxValidationFlags.... TxVlaidationFlags is same as []byte as far as type is concerned.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L39)<br><strong>Comment</strong>: <pre>Lets keep it simple for now. I think that we would not need Capacity/expansion etc. We would now the number of transactions as well as number of flags in the block. Even if we would need to expand, we can simply use built-in `append` function because, TxValidationFlags is a []byte</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L46)<br><strong>Comment</strong>: <pre>It should be simply `return ba[i]`. Returning `0` for out of bound index is incorrect.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/core/ledger/util/txvalidationflags.go#L52)<br><strong>Comment</strong>: <pre>If you decide to keep this function (see file level comments), can we change the name `IsSetTo`. IsSet was meaningful for bitarray but could be misleading here.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [protos/common/common.proto#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/65522a9444b43dc49f077becbe7cc93b454a155c/protos/common/common.proto#L55)<br><strong>Comment</strong>: <pre>This should be defined in fabric/protos/peer/transaction.proto</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 3:04:27 AM<br><strong>UnmergedRevision</strong>: [c640db167a911bf6cffe899aeddd0e91717b3d3a](https://github.com/hyperledger-gerrit-archive/fabric/commit/c640db167a911bf6cffe899aeddd0e91717b3d3a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 3:10:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 3:16:30 AM<br><strong>UnmergedRevision</strong>: [d7843869cf2f6187f61a166ca17da8eef909aa1f](https://github.com/hyperledger-gerrit-archive/fabric/commit/d7843869cf2f6187f61a166ca17da8eef909aa1f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 3:23:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 5:45:27 AM<br><strong>UnmergedRevision</strong>: [18f6c765b5a92a6f9808c72e191f63e33eba919b](https://github.com/hyperledger-gerrit-archive/fabric/commit/18f6c765b5a92a6f9808c72e191f63e33eba919b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 5:59:13 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 5:49:21 AM<br><strong>UnmergedRevision</strong>: [f3a1e4be4c8947f6b1ea7d8acff0631dd54e4a7d](https://github.com/hyperledger-gerrit-archive/fabric/commit/f3a1e4be4c8947f6b1ea7d8acff0631dd54e4a7d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 6:02:17 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 5:55:40 AM<br><strong>UnmergedRevision</strong>: [c6c2a965b44d1ffbf34184fc4a3e3cf1eec09efb](https://github.com/hyperledger-gerrit-archive/fabric/commit/c6c2a965b44d1ffbf34184fc4a3e3cf1eec09efb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 6:09:19 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/c6c2a965b44d1ffbf34184fc4a3e3cf1eec09efb/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>Thanks for simplifying this. In fact, I was suggesting something even simpler. Do you think that there would be an issue if you just have following?


type TxValidationFlags []uint8

func NewTxValidationFlags(size int) TxValidationFlags {
	return make(TxValidationFlags, size)
}

func (obj TxValidationFlags) SetFlag(i int, flag peer.TxValidationResult) {
	obj[i] = uint8(flag)
}

func (obj TxValidationFlags) Flag(i int) peer.TxValidationResult {
	return peer.TxValidationResult(obj[i])
}

func (obj TxValidationFlags) IsSetTo(i int, flag peer.TxValidationResult) bool {
	return obj.Flag(i) == flag
}

Because, TxValidationFlags is []uint8 - it can be savedto and instantiated from bytes as is.</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/15/2017, 1:51:07 PM<br><strong>UnmergedRevision</strong>: [3f400ca443b91170352172a148087d8df43e57fc](https://github.com/hyperledger-gerrit-archive/fabric/commit/3f400ca443b91170352172a148087d8df43e57fc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2017, 2:04:52 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/16/2017, 2:41:27 AM<br><strong>UnmergedRevision</strong>: [b35690599b38b12d171f9314e260b13820fc230c](https://github.com/hyperledger-gerrit-archive/fabric/commit/b35690599b38b12d171f9314e260b13820fc230c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2017, 2:55:07 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/b35690599b38b12d171f9314e260b13820fc230c/core/ledger/util/txvalidationflags.go#L30)<br><strong>Comment</strong>: <pre>I don't think we should use pointer to []uint8... If you don't mind, can you have the much simpler code for this struct (the one that I had suggested in one of the previous comments). And then let's see what problem we run into?</pre></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/16/2017, 9:32:46 AM<br><strong>UnmergedRevision</strong>: [95ce5db33af7886ad5cbe1701736ba846010d671](https://github.com/hyperledger-gerrit-archive/fabric/commit/95ce5db33af7886ad5cbe1701736ba846010d671)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2017, 10:00:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L166](https://github.com/hyperledger-gerrit-archive/fabric/blob/95ce5db33af7886ad5cbe1701736ba846010d671/core/committer/txvalidator/validator.go#L166)<br><strong>Comment</strong>: <pre>Update the comment about 'bit array'.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L133](https://github.com/hyperledger-gerrit-archive/fabric/blob/95ce5db33af7886ad5cbe1701736ba846010d671/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L133)<br><strong>Comment</strong>: <pre>Update the comment about bit array.</pre></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/17/2017, 3:02:15 AM<br><strong>UnmergedRevision</strong>: [f079081f072dea6a7027650479908fa1e7f5b631](https://github.com/hyperledger-gerrit-archive/fabric/commit/f079081f072dea6a7027650479908fa1e7f5b631)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2017, 3:15:10 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/17/2017, 3:51:16 AM<br><strong>UnmergedRevision</strong>: [221c15938048738eea0c5692bc1e2210ecc47ad9](https://github.com/hyperledger-gerrit-archive/fabric/commit/221c15938048738eea0c5692bc1e2210ecc47ad9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2017, 4:03:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/17/2017, 4:31:41 AM<br><strong>UnmergedRevision</strong>: [b6b95bb882ae88b4dc62c145169c9d95bb79e142](https://github.com/hyperledger-gerrit-archive/fabric/commit/b6b95bb882ae88b4dc62c145169c9d95bb79e142)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2017, 10:51:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/18/2017, 2:48:03 PM<br><strong>UnmergedRevision</strong>: [548039074b978700a36d8db731d88ee265ed8a10](https://github.com/hyperledger-gerrit-archive/fabric/commit/548039074b978700a36d8db731d88ee265ed8a10)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2017, 3:15:03 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/18/2017, 5:15:57 PM<br><strong>UnmergedRevision</strong>: [245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd](https://github.com/hyperledger-gerrit-archive/fabric/commit/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2017, 6:34:43 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L149](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/common/ledger/blkstorage/fsblkstorage/blockindex.go#L149)<br><strong>Comment</strong>: <pre>Will need corresponding test in blockindex_test.go</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L136](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/committer/txvalidator/validator.go#L136)<br><strong>Comment</strong>: <pre>Need to add an invalidation reason for duplicate transaction id.
Also, this should be an Error like the others instead of a Warning.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/committer/txvalidator/validator.go#L144)<br><strong>Comment</strong>: <pre>Need to add an invalidation reason for VSCC failure (endorsement policy failure).</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L72)<br><strong>Comment</strong>: <pre>Need to add a reason code for MVCC validations. Actually we probably want to invalidation codes here, see below for the two.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L94)<br><strong>Comment</strong>: <pre>Aren't there different invalidation codes already set in msgvalidation.go?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L159)<br><strong>Comment</strong>: <pre>Need to add invalidation reason code for MVCC read set  conflict invalidation.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L162](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L162)<br><strong>Comment</strong>: <pre>Need to add invalidation reason code for phantom check invalidation.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L134](https://github.com/hyperledger-gerrit-archive/fabric/blob/245c61e5ed5e471bcde33f11cf8659c1a1c1c3dd/protos/peer/transaction.proto#L134)<br><strong>Comment</strong>: <pre>Maybe last one should be INVALID_OTHER_REASON.  Could we make it number 255 so that there is room to add other reason codes? Any issue creating an enum with gaps like that?</pre></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 4:20:12 AM<br><strong>UnmergedRevision</strong>: [8d02d6fbe7eb0e4986e72c7d974459a99c225f9f](https://github.com/hyperledger-gerrit-archive/fabric/commit/8d02d6fbe7eb0e4986e72c7d974459a99c225f9f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 4:42:21 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 5:53:42 AM<br><strong>UnmergedRevision</strong>: [0c61d1b79081c1c54cd61aafcf97dfbde509e025](https://github.com/hyperledger-gerrit-archive/fabric/commit/0c61d1b79081c1c54cd61aafcf97dfbde509e025)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 5:59:16 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 18</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 6:38:18 AM<br><strong>UnmergedRevision</strong>: [345602c73ee69db71cf3bed9def72e5b973fb39d](https://github.com/hyperledger-gerrit-archive/fabric/commit/345602c73ee69db71cf3bed9def72e5b973fb39d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 7:12:58 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 19</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 8:08:24 AM<br><strong>UnmergedRevision</strong>: [7baa06f064088692688f568698fa7d1c50953945](https://github.com/hyperledger-gerrit-archive/fabric/commit/7baa06f064088692688f568698fa7d1c50953945)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 8:44:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 20</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 10:11:46 AM<br><strong>UnmergedRevision</strong>: [c0e7b9bad201bd01dcd714e4d4d57b1f049f4871](https://github.com/hyperledger-gerrit-archive/fabric/commit/c0e7b9bad201bd01dcd714e4d4d57b1f049f4871)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 10:54:22 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 21</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 11:10:50 AM<br><strong>UnmergedRevision</strong>: [bcf198e1c4747f33c23abead67dcb29102750d90](https://github.com/hyperledger-gerrit-archive/fabric/commit/bcf198e1c4747f33c23abead67dcb29102750d90)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 11:42:38 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 22</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 11:15:27 AM<br><strong>UnmergedRevision</strong>: [20d1ec44de8b923ec5cc553e898a9013bc579831](https://github.com/hyperledger-gerrit-archive/fabric/commit/20d1ec44de8b923ec5cc553e898a9013bc579831)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 11:46:04 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 23</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 12:21:43 PM<br><strong>UnmergedRevision</strong>: [4feccc8d7f6de5b6b32b976e35c6bae24d23e1a8](https://github.com/hyperledger-gerrit-archive/fabric/commit/4feccc8d7f6de5b6b32b976e35c6bae24d23e1a8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 12:47:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 24</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/19/2017, 12:27:31 PM<br><strong>UnmergedRevision</strong>: [19a1dced185fae574659fa59a2e8f69a3b997633](https://github.com/hyperledger-gerrit-archive/fabric/commit/19a1dced185fae574659fa59a2e8f69a3b997633)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2017, 12:55:56 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 25</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 2/20/2017, 4:47:21 AM<br><strong>UnmergedRevision</strong>: [7e7e571fd92e9135bcb5979739c0906aa8fc1e88](https://github.com/hyperledger-gerrit-archive/fabric/commit/7e7e571fd92e9135bcb5979739c0906aa8fc1e88)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/20/2017, 6:11:01 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 26</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/20/2017, 4:54:45 AM<br><strong>UnmergedRevision</strong>: [96038436878dd4ebcb5c9399b8d9ff09367f48c4](https://github.com/hyperledger-gerrit-archive/fabric/commit/96038436878dd4ebcb5c9399b8d9ff09367f48c4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/20/2017, 5:34:09 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 27</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 2/20/2017, 6:53:32 AM<br><strong>UnmergedRevision</strong>: [1c69e8343a7e69bbb6eb76556a318d968fa8be0f](https://github.com/hyperledger-gerrit-archive/fabric/commit/1c69e8343a7e69bbb6eb76556a318d968fa8be0f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/20/2017, 9:47:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/blockstorage.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/blockstorage.go#L37)<br><strong>Comment</strong>: <pre>In fact, there should not be need for a new index. We already have an index on txid (see line 34). (better to encode the txvalidation result along with the value of the existing index). However, because, this is something internal implementation issue, we can change that later in a separate CR.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/fsblkstorage/blockindex.go#L247)<br><strong>Comment</strong>: <pre>we can return -1 (instead of NOT_DEFINED) for these cases.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/fsblkstorage/blockindex.go#L247)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L252](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/fsblkstorage/blockindex.go#L252)<br><strong>Comment</strong>: <pre>len != -1 would happen in the case of a serious error. We should rather return error with proper message...

Alone, this check is not enough. What if raw is nil? Add another check for raw == nil... (see line 221)</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L252](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/fsblkstorage/blockindex.go#L252)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L252](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/common/ledger/blkstorage/fsblkstorage/blockindex.go#L252)<br><strong>Comment</strong>: <pre>For nil case, please return `blkstorage.ErrAttrNotIndexed` (see line 238) rather than "invalid value"</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L349](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/common/validation/msgvalidation.go#L349)<br><strong>Comment</strong>: <pre>returning code and error both with same meaning could be confusing. Better to use only one.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L349](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/common/validation/msgvalidation.go#L349)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L349](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/common/validation/msgvalidation.go#L349)<br><strong>Comment</strong>: <pre>needs to done below as well.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L369](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/common/validation/msgvalidation.go#L369)<br><strong>Comment</strong>: <pre>Will error be always because of this reason? See comment in line 349</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L369](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/common/validation/msgvalidation.go#L369)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L122](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L122)<br><strong>Comment</strong>: <pre>In the case of error, no need to set txResult etc... we are simply returning with error. This setting of txResult may cause confusion.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L122](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L122)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L140](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L140)<br><strong>Comment</strong>: <pre>For this situation, you may like to define one more code - `UNKOWN_TX_TYPE`</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L140](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L140)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L145](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L145)<br><strong>Comment</strong>: <pre>won't this set the code `_INVALID` for all invalid transactions and cause the real code in variable `txResult` (at line 119) be lost? Better to get rid of bool variable `valid` at line 117 and everywhere just use codes.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L145](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L145)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L165)<br><strong>Comment</strong>: <pre>now no need to return bool from this method... as mentioned above, better to get rid of bool and just use codes. Else, it may cause confusions such as line 145.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L165)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L169)<br><strong>Comment</strong>: <pre>In the case of error returning `peer.TxValidationResult_MVCC_READ_CONFLICT` may be misleading. Do you want to introduce a code say `TxValidationError`? Otherwise, if the caller of this function prints a log message, it may mislead as if MVCC conflict is causing the error.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L169)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L173](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L173)<br><strong>Comment</strong>: <pre>same as above.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L173](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L173)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>please add comments on the exported types and functions. I see lint warnings in my vscode editor.
Also, better to change the function parameter name from 'i' to something more meaningful... `txIndex`?

Also, please do not change this back to the previous versions of this file.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>Still there are no comments on exported Functions. (e.g., SetFlag())</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L53)<br><strong>Comment</strong>: <pre>Do you want to change this to `validationResult` or `validationCode`?</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L53)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L125)<br><strong>Comment</strong>: <pre>INVALID does not make sense - when we have detailed codes for various causes of invalid. IMO, you should remove this INVALID from enum.

If you are using it somewhere, better to use either one of the existing codes or add one more suitable code.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L125)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L126)<br><strong>Comment</strong>: <pre>Please remove NOT_DEFINED. Why would peer ever set this in the array?</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/1c69e8343a7e69bbb6eb76556a318d968fa8be0f/protos/peer/transaction.proto#L126)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 28</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/21/2017, 4:12:20 AM<br><strong>UnmergedRevision</strong>: [320a900be38f15052e704fc816a4792f6324eb01](https://github.com/hyperledger-gerrit-archive/fabric/commit/320a900be38f15052e704fc816a4792f6324eb01)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2017, 5:43:48 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/committer/txvalidator/txvalidator_test.go#L0)<br><strong>Comment</strong>: <pre>Please see the comments below. I had made these changes and you reversed these in this patch...</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/committer/txvalidator/txvalidator_test.go#L37)<br><strong>Comment</strong>: <pre>I had renamed this function name because this name is misleading. Appears that this function was copied and hence got the name...</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/committer/txvalidator/txvalidator_test.go#L37)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L111](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/committer/txvalidator/txvalidator_test.go#L111)<br><strong>Comment</strong>: <pre>I had changed this to zero because block numbers now starts from 0 (not 1)...</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L111](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/committer/txvalidator/txvalidator_test.go#L111)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L44)<br><strong>Comment</strong>: <pre>This function needs a cleanup... 
when it returns an error, it should not return a code. Error means that there was a processing error and code could not be determined (you can use -1 code for these cases).

If we return a code, we should not return an error. e.g., line 57, if we want to preserve the transaction which encountered an UNMARSHAL_ERROR, why throw error? (We have already marked the transaction with code).</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L44)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L91)<br><strong>Comment</strong>: <pre>This function needs cleanup to be coherent with function `validateEndorserTX`. e.g., line 123, the block will not be processed at all if function `validateEndorserTX` returns an error. Which means that `peer.TxValidationCode_UNMARSHAL_RWSET_ERROR` will never be set in the flag then what is the purpose of this code?</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L91)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L187)<br><strong>Comment</strong>: <pre>Is returning `true` has a value here?</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L187)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>please add comments on exported functions as well.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/protos/peer/transaction.proto#L53)<br><strong>Comment</strong>: <pre>Renaming TxVaidationResults to TxVaidationCode is fine but My comment about `validationCode` was mainly about this variable `valid` at line 53...Please see the comment on last patch.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [protos/peer/transaction.proto#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/320a900be38f15052e704fc816a4792f6324eb01/protos/peer/transaction.proto#L53)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 29</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/21/2017, 6:32:25 AM<br><strong>UnmergedRevision</strong>: [c80c2506d0e9b6a5c343b3c155d6b3157e27c984](https://github.com/hyperledger-gerrit-archive/fabric/commit/c80c2506d0e9b6a5c343b3c155d6b3157e27c984)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2017, 7:54:48 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L64](https://github.com/hyperledger-gerrit-archive/fabric/blob/c80c2506d0e9b6a5c343b3c155d6b3157e27c984/core/committer/txvalidator/txvalidator_test.go#L64)<br><strong>Comment</strong>: <pre>We should use t.Logf to output instead of this and run with -v flag</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/txvalidator_test.go#L64](https://github.com/hyperledger-gerrit-archive/fabric/blob/c80c2506d0e9b6a5c343b3c155d6b3157e27c984/core/committer/txvalidator/txvalidator_test.go#L64)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 30</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/22/2017, 4:07:40 AM<br><strong>UnmergedRevision</strong>: [6423acb8c05131a5c3c075689a6013280d8c4467](https://github.com/hyperledger-gerrit-archive/fabric/commit/6423acb8c05131a5c3c075689a6013280d8c4467)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/22/2017, 5:18:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/6423acb8c05131a5c3c075689a6013280d8c4467/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L126)<br><strong>Comment</strong>: <pre>move this line after the error check. In the case of error, the txResult could be -1 which would raise a panic when setting into []uint8</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L143](https://github.com/hyperledger-gerrit-archive/fabric/blob/6423acb8c05131a5c3c075689a6013280d8c4467/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L143)<br><strong>Comment</strong>: <pre>this if needs an else. Otherwise, by default the flag is anyways marked as valid</pre></blockquote><h3>PatchSet Number: 31</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/23/2017, 6:01:53 AM<br><strong>UnmergedRevision</strong>: [65d83f545bc9df111b0e318213e03656e8e76286](https://github.com/hyperledger-gerrit-archive/fabric/commit/65d83f545bc9df111b0e318213e03656e8e76286)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/23/2017, 7:58:02 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/common/ledger/blkstorage/fsblkstorage/blockindex.go#L254)<br><strong>Comment</strong>: <pre>You would want to return `ErrAttNotIndexed` only in the case of nil. In the case of len != 1, you would still retrun an error with proper message (previous message was fine).</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/common/ledger/blkstorage/fsblkstorage/blockindex.go#L254)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/common/ledger/blkstorage/fsblkstorage/blockindex.go#L254)<br><strong>Comment</strong>: <pre>The latest isn't exactly what Manish asked for, he wanted len != 1 to return a different error.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [common/ledger/blkstorage/fsblkstorage/blockindex.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/common/ledger/blkstorage/fsblkstorage/blockindex.go#L254)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L100)<br><strong>Comment</strong>: <pre>Add a code comment about what the initialized values will be - valid or invalid? (see next comment).</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L100)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L104)<br><strong>Comment</strong>: <pre>In earlier patches, we used to initialize the flag to INVALID at the beginning, and then switch it to valid at the end if everything was good (INVALID was the fallback).

Now we initialize it to VALID, which means we have to exhaustively set it to an invalid code if anything goes wrong.  So we either need to set it to invalid here, or initialize as invalid (perhaps INVALID_OTHER_REASON).</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L104)<br><strong>Comment</strong>: <pre>I have added comments to txflags constructor</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L124)<br><strong>Comment</strong>: <pre>In earlier patches, we used to initialize the flag to INVALID at the beginning, and then switch it to valid at the end if everything was good (INVALID was the fallback).

Now we initialize it to VALID, which means we have to exhaustively set it to an invalid code if anything goes wrong.  So we either need to set it to invalid here, or initialize as invalid (perhaps INVALID_OTHER_REASON).</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L124)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L172](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L172)<br><strong>Comment</strong>: <pre>This is a marshal error, not a unmarshal error.

Not sure why the tran envelope needs to be marshaled here in the first place - it is never used, but that is not a problem for this changeset.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L172](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L172)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L185](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L185)<br><strong>Comment</strong>: <pre>It is not a bit array anymore.  It is a []uint8, also known as []byte.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L185](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/committer/txvalidator/validator.go#L185)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48)<br><strong>Comment</strong>: <pre>Why do we return nil error here...but return err in line 57?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48)<br><strong>Comment</strong>: <pre>Dave - please see comment in line 57</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L48)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57)<br><strong>Comment</strong>: <pre>what is TxValidationCode of -1?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57)<br><strong>Comment</strong>: <pre>Hi Dave, I had suggested Ruslan to follow this practice - that is these types of methods (which validate an individual transaction) should either throw an error or one of the legitimate codes. The error should be returned when there is a situation (if any) that should cause the rejection of whole block. In any other case, one of the legitimate code should be returned. In this case, I think that UnmarshallError code should be returned and error should be nil.

About '-1', this represent `not a legitimate code` in the case of an error.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L57)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105)<br><strong>Comment</strong>: <pre>I don't think we have added the invalidation reason code to debug log up to now, this would be a good place to do it.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105)<br><strong>Comment</strong>: <pre>Actually, for invalid transactions, a Warning log message would be more appropriate than a Debug log message.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L105)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151)<br><strong>Comment</strong>: <pre>Lets at a debug log message here to indicate final validation/invalidation reason code.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151)<br><strong>Comment</strong>: <pre>Actually Debug if valid, Warning if invalid.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator.go#L151)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>There is a convention of writing comments in golang (e.g., first word of the comment line is the name of the type/function). Should be easy to get on ineternet. Please fix accordingly.</pre><strong>Commenter</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/txvalidationflags.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/65d83f545bc9df111b0e318213e03656e8e76286/core/ledger/util/txvalidationflags.go#L0)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 32</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/26/2017, 11:19:42 AM<br><strong>UnmergedRevision</strong>: [841bc5e4d7576e3f111763c1052c480717365f26](https://github.com/hyperledger-gerrit-archive/fabric/commit/841bc5e4d7576e3f111763c1052c480717365f26)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/26/2017, 12:39:35 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 33</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/27/2017, 2:46:11 AM<br><strong>UnmergedRevision</strong>: [4724f6a2db7a7cd98f5162b54a859d651b08d2f9](https://github.com/hyperledger-gerrit-archive/fabric/commit/4724f6a2db7a7cd98f5162b54a859d651b08d2f9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/27/2017, 2:51:18 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 34</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Created</strong>: 2/27/2017, 2:48:27 AM<br><strong>UnmergedRevision</strong>: [13b191cbdb4d4eabeda62230ce2351623659fa4a](https://github.com/hyperledger-gerrit-archive/fabric/commit/13b191cbdb4d4eabeda62230ce2351623659fa4a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/27/2017, 4:08:39 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 35</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ruslan Kryukov - ruslan.kryukov@ru.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 2/27/2017, 5:30:13 AM<br><strong>GitHubMergedRevision</strong>: [29d7fc035df697a68d271d628e693c556354486f](https://github.com/hyperledger-gerrit-archive/fabric/commit/29d7fc035df697a68d271d628e693c556354486f)<br><br><strong>Approver</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Approved</strong>: 2/27/2017, 9:45:19 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/27/2017, 6:58:27 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Approved</strong>: 2/27/2017, 8:31:14 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 2/27/2017, 10:32:43 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Srinivasan Muralidharan<br><strong>Merged</strong>: 2/27/2017, 10:32:46 AM<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 2/27/2017, 6:47:44 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 2/27/2017, 5:32:20 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>